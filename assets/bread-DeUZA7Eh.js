var we=Object.defineProperty;var K=Object.getOwnPropertySymbols;var be=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var W=(m,u,s)=>u in m?we(m,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[u]=s,P=(m,u)=>{for(var s in u||(u={}))be.call(u,s)&&W(m,s,u[s]);if(K)for(var s of K(u))ke.call(u,s)&&W(m,s,u[s]);return m};var f=(m,u,s)=>new Promise(($,V)=>{var B=g=>{try{n(s.next(g))}catch(w){V(w)}},x=g=>{try{n(s.throw(g))}catch(w){V(w)}},n=g=>g.done?$(g.value):Promise.resolve(g.value).then(B,x);n((s=s.apply(m,u)).next())});import{_ as Ce,g as De,r,J as Ve,x as xe,Y as Se,d as p,M as Ne,c as Ue,o as b,s as D,l as I,e as O,f as e,N as X,h as o,k as v,O as Ie,E as q,D as _}from"./index-BxoItr7S.js";import Be from"./index-B_oFCXxs.js";import Te from"./index-CmaQYcJb.js";import Pe from"./index-B6tTlV03.js";import{g as $e,a as Le,d as Ee,u as z,b as Fe}from"./index-DYSDCzw9.js";import"./index-CmtOAOSu.js";const Oe={class:"app-container"},qe={class:"list-container"},ze=["src","onClick"],Je={class:"dialog-footer"},Re={__name:"bread",setup(m){const{proxy:u}=De(),{sys_bread_type:s,sys_food_type:$}=u.useDict("sys_bread_type","sys_food_type"),V=r([{type:"input",prop:"name",label:"菜品名称",placeholder:"请输入菜品名称"},{type:"select",prop:"categoryId",label:"菜品分类",placeholder:"请选择菜品分类",options:[]},{type:"select",prop:"difficulty",label:"制作难度",placeholder:"请选择制作难度",options:[{value:"简单",label:"简单"},{value:"适中",label:"适中"},{value:"较难",label:"较难"},{value:"极难",label:"极难"}]},{type:"select",prop:"status",label:"状态",placeholder:"请选择状态",options:[{value:"0",label:"已下架"},{value:"1",label:"已上架"}]}]),B=r([{type:"select",prop:"categoryId",label:"菜品分类",width:12,formItemProps:{placeholder:"请选择菜品分类"},options:[],rule:[{required:!0,message:"请选择菜品分类",trigger:"change"}]},{type:"input",prop:"name",label:"菜品名称",width:12,formItemProps:{placeholder:"请输入菜品名称"},rule:[{required:!0,message:"请输入菜品名称",trigger:"blur"}]},{type:"select",prop:"difficulty",label:"制作难度",width:12,formItemProps:{placeholder:"请选择制作难度"},options:[{value:"简单",label:"简单"},{value:"适中",label:"适中"},{value:"较难",label:"较难"},{value:"极难",label:"极难"}],rule:[{required:!0,message:"请选择制作难度",trigger:"change"}]},{type:"upload",uploadType:"img",listType:"picture-card",limit:1,prop:"fileList",label:"菜品图片",width:12,formItemProps:{placeholder:"请上传菜品图片"}}]),x=r([]),n=Ve({tableData:[],total:0,formData:{}}),g=r([]),w=r(!0),y=r([{name:"",weight:""}]),k=r([{content:""}]),S=r({pageNum:1,pageSize:10}),J=r({}),N=r(!1),R=r(!0),U=r(""),C=r(!1),A=r(null),L=r(!1),M=r(""),Z=r("0"),H=r([]),h=()=>f(this,null,function*(){N.value=!0;try{let t=yield $e(P(P({},S.value),J.value));n.tableData=t.rows,n.total=t.total,N.value=!1}catch(t){N.value=!1}}),ee=t=>f(this,null,function*(){N.value=!0,J.value=t,h()}),E=t=>{g.value=t.map(l=>l.id),R.value=!t.length},te=()=>{U.value="新增菜品",C.value=!0},ae=t=>{U.value="修改菜品",C.value=!0,n.formData=P({},t),n.formData.fileList=[{url:n.formData.img}],y.value=JSON.parse(JSON.stringify(t.foodUsage)),k.value=JSON.parse(JSON.stringify(t.steps))},Q=t=>{q.confirm("是否确认删除该备忘录？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>f(this,null,function*(){let l=t.id||g.value;yield Ee({id:l}),h(),_({type:"success",message:"删除成功"})})).catch(()=>{_({type:"info",message:"取消删除"})})},le=t=>{q.confirm("是否上架该菜品？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>f(this,null,function*(){let l=t.id;yield z({id:l,status:"1"}),h(),_({type:"success",message:"更改成功"})})).catch(()=>{_({type:"info",message:"取消更改"})})},oe=t=>{q.confirm("是否下架该菜品？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>f(this,null,function*(){let l=t.id;yield z({id:l,status:"0"}),h(),_({type:"success",message:"更改成功"})})).catch(()=>{_({type:"info",message:"取消更改"})})},ne=()=>f(this,null,function*(){A.value.submitRef().then(t=>f(this,null,function*(){var l;t&&(C.value=!1,(l=n.formData.fileList)!=null&&l.length?n.formData.img=n.formData.fileList[0].url:n.formData.img="",console.log(y.value,"usageArr"),n.formData.foodUsage=y.value,n.formData.steps=k.value,console.log(n.formData,"state.formData"),U.value=="新增菜品"?(yield Fe(n.formData),_.success("新增成功")):U.value=="修改菜品"&&(yield z(n.formData),_.success("修改成功")),h())}))}),se=()=>{C.value=!1,_.info("取消")},ie=()=>f(this,null,function*(){let t=yield Le({pageNum:1,pageSize:1e3});x.value=$.value,x.value.forEach(l=>{l.children=t.rows.filter(i=>i.categoryId==l.value).map(i=>({label:i.name,value:i.name}))})}),re=()=>{n.formData={},y.value=[{name:"",weight:""}],k.value=[{content:""}],console.log("关闭",y.value)},ue=(t,l)=>{H.value=[{url:t}],M.value=l,L.value=!0},ce=t=>{y.value.splice(t,1)},de=()=>{y.value.push({name:"",weight:""})},pe=t=>{k.value.splice(t,1)},me=()=>{k.value.push({content:""})};return xe(()=>f(this,null,function*(){yield h(),yield ie()})),Se(()=>{n.tableData=n.tableData.map(t=>{var l;return t.categoryName=(l=s.value.find(i=>i.value==t.categoryId))==null?void 0:l.label,t}),V.value.find(t=>t.prop=="categoryId").options=s.value,B.value.find(t=>t.prop=="categoryId").options=s.value}),(t,l)=>{const i=p("el-button"),Y=p("el-col"),ge=p("right-toolbar"),fe=p("el-row"),c=p("el-table-column"),j=p("el-tag"),T=p("el-tooltip"),F=p("el-table"),ve=p("pagination"),_e=p("el-cascader"),G=p("el-input"),ye=p("el-dialog"),he=Ne("loading");return b(),Ue("div",Oe,[w.value?(b(),D(Be,{key:0,settings:V.value,onHandleSearch:ee},null,8,["settings"])):I("",!0),O("div",qe,[e(fe,{gutter:10,class:"mb8"},{default:o(()=>[e(Y,{span:1.5},{default:o(()=>[e(i,{type:"primary",plain:"",icon:"Plus",onClick:te},{default:o(()=>[v("新增")]),_:1})]),_:1}),e(Y,{span:1.5},{default:o(()=>[e(i,{type:"danger",plain:"",icon:"Delete",disabled:R.value,onClick:Q},{default:o(()=>[v("删除")]),_:1},8,["disabled"])]),_:1}),e(ge,{showSearch:w.value,"onUpdate:showSearch":l[0]||(l[0]=a=>w.value=a),onQueryTable:h},null,8,["showSearch"])]),_:1}),X((b(),D(F,{data:n.tableData,onSelectionChange:E},{default:o(()=>[e(c,{type:"selection",width:"50",align:"center"}),e(c,{label:"菜品名称",align:"center",prop:"name"}),e(c,{label:"分类",align:"center",prop:"categoryName"}),e(c,{label:"难度",align:"center",prop:"difficulty"}),e(c,{label:"图片",align:"center",prop:"img"},{default:o(a=>[O("img",{src:a.row.img,style:{width:"50px",height:"50px",cursor:"pointer"},onClick:d=>ue(a.row.img,"菜品图片")},null,8,ze)]),_:1}),e(c,{label:"状态",align:"center",prop:"status"},{default:o(a=>[a.row.status=="1"?(b(),D(j,{key:0,type:"success"},{default:o(()=>[v("已上架")]),_:1})):I("",!0),a.row.status=="0"?(b(),D(j,{key:1,type:"danger"},{default:o(()=>[v("已下架")]),_:1})):I("",!0)]),_:1}),e(c,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:o(a=>[e(T,{content:"修改",placement:"top"},{default:o(()=>[e(i,{link:"",type:"primary",icon:"Edit",onClick:d=>ae(a.row)},null,8,["onClick"])]),_:2},1024),e(T,{content:"删除",placement:"top"},{default:o(()=>[e(i,{link:"",type:"primary",icon:"Delete",onClick:d=>Q(a.row)},null,8,["onClick"])]),_:2},1024),a.row.status=="0"?(b(),D(T,{key:0,content:"上架",placement:"top"},{default:o(()=>[e(i,{link:"",type:"primary",icon:"CircleCheck",onClick:d=>le(a.row)},null,8,["onClick"])]),_:2},1024)):I("",!0),a.row.status=="1"?(b(),D(T,{key:1,content:"下架",placement:"top"},{default:o(()=>[e(i,{link:"",type:"primary",icon:"CircleClose",onClick:d=>oe(a.row)},null,8,["onClick"])]),_:2},1024)):I("",!0)]),_:1})]),_:1},8,["data"])),[[he,N.value]]),X(e(ve,{total:n.total,page:S.value.pageNum,"onUpdate:page":l[1]||(l[1]=a=>S.value.pageNum=a),limit:S.value.pageSize,"onUpdate:limit":l[2]||(l[2]=a=>S.value.pageSize=a),onPagination:h},null,8,["total","page","limit"]),[[Ie,n.total>0]])]),e(ye,{title:U.value,modelValue:C.value,"onUpdate:modelValue":l[4]||(l[4]=a=>C.value=a),width:"40%",onClosed:re,draggable:"","destroy-on-close":!0},{footer:o(()=>[O("div",Je,[e(i,{type:"primary",onClick:ne},{default:o(()=>[v("确 定")]),_:1}),e(i,{onClick:se},{default:o(()=>[v("取 消")]),_:1})])]),default:o(()=>[e(Te,{settings:B.value,modelValue:n.formData,"onUpdate:modelValue":l[3]||(l[3]=a=>n.formData=a),ref_key:"base_form",ref:A},null,8,["settings","modelValue"]),e(F,{data:y.value,onSelectionChange:E},{default:o(()=>[e(c,{label:"食材",align:"center",prop:"name"},{default:o(a=>[e(_e,{modelValue:a.row.name,"onUpdate:modelValue":d=>a.row.name=d,placeholder:"请选择食材",options:x.value,props:{emitPath:!1},filterable:""},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),e(c,{label:"用量",align:"center",prop:"weight"},{default:o(a=>[e(G,{modelValue:a.row.weight,"onUpdate:modelValue":d=>a.row.weight=d,placeholder:"请输入用量"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:o(a=>[e(i,{type:"danger",link:"",onClick:d=>ce(a.$index)},{default:o(()=>[v("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(i,{type:"primary",plain:"",style:{width:"100%","margin-top":"15px"},onClick:de},{default:o(()=>[v("添加")]),_:1}),e(F,{data:k.value,onSelectionChange:E,style:{"margin-top":"15px"}},{default:o(()=>[e(c,{label:"序号",align:"center",width:"60",type:"index"}),e(c,{label:"步骤内容",align:"center",prop:"content"},{default:o(a=>[e(G,{modelValue:a.row.content,"onUpdate:modelValue":d=>a.row.content=d,placeholder:"请输入步骤内容"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:o(a=>[e(i,{type:"danger",link:"",onClick:d=>pe(a.$index)},{default:o(()=>[v("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(i,{type:"primary",plain:"",style:{width:"100%","margin-top":"15px"},onClick:me},{default:o(()=>[v("添加")]),_:1})]),_:1},8,["title","modelValue"]),e(Pe,{modelValue:L.value,"onUpdate:modelValue":l[5]||(l[5]=a=>L.value=a),size:"auto","img-list":H.value,title:M.value,"init-number":Z.value},null,8,["modelValue","img-list","title","init-number"])])}}},Ke=Ce(Re,[["__scopeId","data-v-1ce6faa3"]]);export{Ke as default};
