var j=(_,B,v)=>new Promise((c,a)=>{var b=f=>{try{g(v.next(f))}catch(h){a(h)}},V=f=>{try{g(v.throw(f))}catch(h){a(h)}},g=f=>f.done?c(f.value):Promise.resolve(f.value).then(b,V);g((v=v.apply(_,B)).next())});import{_ as se,J as ne,r as m,a9 as ue,G as de,w as ce,Y as fe,d as p,c as k,o as r,f as P,h as u,F as U,z as C,s as n,l as d,a0 as ie,Z as y,k as E,A as me,Q as _e,aa as ye,ab as ve,D as w,e as be,p as ge,q as he}from"./index-CUeo8D_D.js";import Ve from"./index-ZxZv3TUJ.js";import"./index-D7f4lOdi.js";const De=_=>(ge("data-v-ba9f6ed9"),_=_(),he(),_),ke=De(()=>be("div",{class:"el-upload__tip"}," 仅支持mp4格式视频，大小不能超过200MB！ ",-1)),Ue={__name:"index",props:{settings:{type:Array,default:[]},modelValue:{type:Object,default:{}},inline:{type:Boolean,default:!1}},emits:["handleSearch","handleReset","update:modelValue","selectChange","openMap"],setup(_,{expose:B,emit:v}){const c=_,a=ne({formData:{}});m([]),m([]);const b=m(),V=m(!1),g=m([]),f=m("图片预览"),h=m(0),z=m({headers:{Authorization:"Bearer "+ue()},url:"/ruoyi/file/upload"}),D=m([]),I=v,M=o=>{I("update:modelValue",a.formData),I("selectChange",a.formData[o.prop])},S=()=>{I("update:modelValue",a.formData)},A=de(()=>{let o={};return c.settings.forEach(t=>{o[t.prop]=t.rule}),o}),L=()=>j(this,null,function*(){if(b.value)return new Promise(o=>{b.value.validate((t,i)=>{o(t)})})}),N=()=>{b.value.clearValidate()},R=()=>{let o=null;c.settings.forEach((t,i)=>{var s;if(t.width==24)D.value.push({cols:[t]});else if(t.width==12&&o!=i)if(((s=c.settings[i+1])==null?void 0:s.width)==12){o=i+1;let x=[t,c.settings[i+1]];D.value.push({cols:x})}else D.value.push({cols:[t]})})},$=(o,t)=>{if(t=="img"){if(o.type!="image/jpeg"&&o.type!="image/png"&&o.type!="image/jpg")return w.error("仅支持jpg、jpeg、png格式"),!1;if(o.size/1024/1024>10)return w.error("请上传小于10MB的图片!"),!1}else if(t=="video"){if(o.type!="video/mp4"&&o.type!="video/quicktime"&&o.type!="video/avi"&&o.type!="video/x-flv"&&o.type!="video/x-ms-wmv")return w.error("仅支持mp4、mov、avi、flv、wmv格式"),!1;if(o.size/1024/1024>200)return w.error("请上传小于200MB的视频!"),!1}return console.log("到这里"),!0},q=(o,t,i,s)=>{o.code=="0"||o.code=="200"?(a.formData[s.prop][a.formData[s.prop].length-1].url=o.data.url,I("update:modelValue",a.formData)):(a.formData[s.prop][a.formData[s.prop].length-1].status="fail",a.formData[s.prop]=a.formData[s.prop].slice(0,a.formData[s.prop].length-1),w.error("上传失败"))},G=o=>{var t;return((t=a.formData[o.prop])==null?void 0:t.length)==o.limit?"disabled-upload":""},H=(o,t,i)=>{h.value=t.findIndex(s=>s.url==o.url),g.value=t,V.value=!0};return B({submitRef:L,resetForm:N}),ce(()=>c.settings,o=>{D.value=[],R(),setTimeout(()=>{N()},0)},{immediate:!0,deep:!0}),fe(()=>{a.formData=c.modelValue}),(o,t)=>{const i=p("el-option"),s=p("el-select"),x=p("el-date-picker"),J=p("el-input"),O=p("el-radio"),Q=p("el-radio-group"),Y=p("el-cascader"),Z=p("el-input-number"),K=p("Plus"),W=p("el-icon"),X=p("el-button"),F=p("el-upload"),ee=p("el-form-item"),oe=p("el-col"),ae=p("el-row"),le=p("el-form");return r(),k(U,null,[P(le,{model:a.formData,"label-width":"120px",rules:A.value,ref_key:"ruleFormRef",ref:b,inline:c.inline,class:"base-form"},{default:u(()=>[(r(!0),k(U,null,C(D.value,(T,te)=>(r(),n(ae,{key:te},{default:u(()=>[(r(!0),k(U,null,C(T.cols,e=>(r(),n(oe,{span:e.width,key:e.prop},{default:u(()=>[P(ee,{label:e.label,prop:e.prop},{default:u(()=>[e.type=="select"?(r(),n(s,y({key:0,filterable:"",modelValue:a.formData[e.prop],"onUpdate:modelValue":l=>a.formData[e.prop]=l},e.formItemProps,{clearable:e.isClearable!="1",onChange:l=>M(e)}),{default:u(()=>[(r(!0),k(U,null,C(e.options,l=>(r(),n(i,{key:l.value,label:l.label,value:l.value,disabled:l.disabled||!1},null,8,["label","value","disabled"]))),128))]),_:2},1040,["modelValue","onUpdate:modelValue","clearable","onChange"])):d("",!0),e.type=="date"?(r(),n(x,y({key:1,modelValue:a.formData[e.prop],"onUpdate:modelValue":l=>a.formData[e.prop]=l,onChange:S},e.formItemProps,{clearable:""}),null,16,["modelValue","onUpdate:modelValue"])):d("",!0),e.type=="input"||e.type=="textarea"?(r(),n(J,y({key:2,modelValue:a.formData[e.prop],"onUpdate:modelValue":l=>a.formData[e.prop]=l},e.formItemProps,{clearable:"",type:e.type,onInput:S}),null,16,["modelValue","onUpdate:modelValue","type"])):d("",!0),e.type=="radio"?(r(),n(Q,y({key:3,modelValue:a.formData[e.prop],"onUpdate:modelValue":l=>a.formData[e.prop]=l},e.formItemProps),{default:u(()=>[(r(!0),k(U,null,C(e.options,l=>(r(),n(O,{label:l.value,size:"default",key:l.value},{default:u(()=>[E(me(l.label),1)]),_:2},1032,["label"]))),128))]),_:2},1040,["modelValue","onUpdate:modelValue"])):d("",!0),e.type=="cascader"?(r(),n(Y,y({key:4,modelValue:a.formData[e.prop],"onUpdate:modelValue":l=>a.formData[e.prop]=l,options:e.options},e.formItemProps),null,16,["modelValue","onUpdate:modelValue","options"])):d("",!0),e.type=="inputNumber"?(r(),n(Z,y({key:5,modelValue:a.formData[e.prop],"onUpdate:modelValue":l=>a.formData[e.prop]=l,"controls-position":"right",onChange:S},e.formItemProps),null,16,["modelValue","onUpdate:modelValue"])):d("",!0),e.type=="upload"?(r(),n(F,{key:6,"file-list":a.formData[e.prop],"onUpdate:fileList":l=>a.formData[e.prop]=l,action:z.value.url,headers:z.value.headers,"list-type":e.listType,"before-upload":l=>$(l,e.uploadType),"on-success":(l,re,pe)=>q(l,re,pe,e),limit:e.limit,class:_e(G(e)),"on-preview":l=>H(l,a.formData[e.prop]),disabled:e.disabled},ye({default:u(()=>[e.uploadType=="img"?(r(),n(W,{key:0},{default:u(()=>[P(K)]),_:1})):d("",!0),e.uploadType=="video"?(r(),n(X,{key:1,type:"primary"},{default:u(()=>[E("上传视频")]),_:1})):d("",!0)]),_:2},[e.uploadType=="video"?{name:"tip",fn:u(()=>[ke]),key:"0"}:void 0]),1032,["file-list","onUpdate:fileList","action","headers","list-type","before-upload","on-success","limit","class","on-preview","disabled"])):d("",!0),o.$slots[e.prop]&&!e.type?ie(o.$slots,e.prop,ve(y({key:7},e)),void 0,!0):d("",!0)]),_:2},1032,["label","prop"])]),_:2},1032,["span"]))),128))]),_:2},1024))),128))]),_:3},8,["model","rules","inline"]),P(Ve,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=T=>V.value=T),"img-list":g.value,title:f.value,"init-number":h.value},null,8,["modelValue","img-list","title","init-number"])],64)}}},Be=se(Ue,[["__scopeId","data-v-ba9f6ed9"]]);export{Be as default};
