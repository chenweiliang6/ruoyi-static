var de=Object.defineProperty;var O=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var j=(n,r,u)=>r in n?de(n,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):n[r]=u,V=(n,r)=>{for(var u in r||(r={}))fe.call(r,u)&&j(n,u,r[u]);if(O)for(var u of O(r))ge.call(r,u)&&j(n,u,r[u]);return n};var f=(n,r,u)=>new Promise((I,S)=>{var s=c=>{try{v(u.next(c))}catch(m){S(m)}},x=c=>{try{v(u.throw(c))}catch(m){S(m)}},v=c=>c.done?I(c.value):Promise.resolve(c.value).then(s,x);v((u=u.apply(n,r)).next())});import{y as N,_ as _e,g as ve,r as i,J as ye,x as he,d as p,M as be,c as we,o as y,s as w,l as k,e as P,f as a,N as H,h as o,k as C,A as J,O as ke,E as L,D as g}from"./index-BxoItr7S.js";import Ce from"./index-B_oFCXxs.js";import De from"./index-CmaQYcJb.js";import Be from"./index-B6tTlV03.js";import{g as Se}from"./user-BXa85Bq3.js";import"./index-CmtOAOSu.js";function xe(n){let r={pageNum:n.pageNum,pageSize:n.pageSize};return N({url:"/memorandum/list",method:"post",data:n,params:r})}function Te(n){return N({url:"/memorandum/add",method:"post",data:n})}function z(n){return N({url:"/memorandum/update",method:"put",data:n})}function Ve(n){return N({url:"/memorandum/"+n.id,method:"delete"})}const Pe={class:"app-container"},Ne={class:"list-container"},Ie={class:"dialog-footer"},Ue=Object.assign({name:"Memorandum"},{__name:"index",setup(n){const{proxy:r}=ve(),{sys_buy_platform:u}=r.useDict("sys_buy_platform"),I=i([{type:"input",prop:"title",label:"标题",placeholder:"请输入标题"},{type:"select",prop:"status",label:"处理状态",placeholder:"请选择处理状态",options:[{label:"未处理",value:"0"},{label:"已处理",value:"1"}]},{type:"date",dateType:"daterange",prop:"timeRange",label:"创建时间",startPlaceholder:"开始日期",endPlaceholder:"结束日期"}]),S=i([{type:"input",prop:"title",label:"标题",width:24,formItemProps:{placeholder:"请输入标题"},rule:[{required:!0,message:"请输入标题",trigger:"blur"}]},{type:"textarea",prop:"content",label:"内容",width:24,formItemProps:{placeholder:"请选择内容"},options:[],rule:[{required:!0,message:"请选择内容",trigger:"change"}]},{type:"select",prop:"status",label:"处理状态",width:24,formItemProps:{placeholder:"请选择处理状态"},options:[{value:"0",label:"未处理"},{value:"1",label:"已处理"}]},{type:"upload",uploadType:"img",listType:"picture-card",limit:3,prop:"fileList",label:"附件",width:24,formItemProps:{placeholder:"请上传附件"}}]),s=ye({tableData:[],total:0,formData:{}}),x=i([]),v=i(!0);i(!1);const c=i({pageNum:1,pageSize:10}),m=i({}),D=i(!1),E=i(!0),M=i({}),B=i(""),h=i(!1),R=i(null),$=i(!1),Q=i(""),G=i("0"),K=i([]),W=()=>f(this,null,function*(){let l=yield Se();M.value=l.data}),_=()=>f(this,null,function*(){D.value=!0;try{m.value.createBy=M.value.userName;let l=yield xe(V(V({},c.value),m.value));s.tableData=l.rows,s.total=l.total,D.value=!1}catch(l){D.value=!1}}),X=l=>f(this,null,function*(){D.value=!0,m.value=l,m.value.startTime=l.timeRange[0],m.value.endTime=l.timeRange[1].split(" ")[0]+" 23:59:59",delete m.value.timeRange,_()}),Y=l=>{x.value=l.map(t=>t.id),E.value=!l.length},Z=()=>{B.value="新增备忘录",h.value=!0},ee=l=>{B.value="修改备忘录",h.value=!0,s.formData=V({},l),s.formData.fileList=s.formData.files.map(t=>({url:t}))},q=l=>{L.confirm("是否确认删除该备忘录？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>f(this,null,function*(){let t=l.id||x.value;yield Ve({id:t}),_(),g({type:"success",message:"删除成功"})})).catch(()=>{g({type:"info",message:"取消删除"})})},te=l=>{L.confirm("是否将状态改为已处理？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>f(this,null,function*(){let t=l.id;yield z({id:t,status:"1"}),_(),g({type:"success",message:"更改成功"})})).catch(()=>{g({type:"info",message:"取消更改"})})},ae=l=>{L.confirm("是否将状态改为未处理？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>f(this,null,function*(){let t=l.id;yield z({id:t,status:"0"}),_(),g({type:"success",message:"更改成功"})})).catch(()=>{g({type:"info",message:"取消更改"})})},le=()=>f(this,null,function*(){R.value.submitRef().then(l=>f(this,null,function*(){var t;l&&(h.value=!1,(t=s.formData.fileList)!=null&&t.length?s.formData.files=s.formData.fileList.map(d=>d.url):s.formData.files=[],B.value=="新增备忘录"?(yield Te(s.formData),g.success("新增成功")):B.value=="修改备忘录"&&(yield z(s.formData),g.success("修改成功")),_())}))}),oe=()=>{h.value=!1,g.info("取消")},ne=()=>{s.formData={}};return he(()=>f(this,null,function*(){yield W(),yield _()})),(l,t)=>{const d=p("el-button"),A=p("el-col"),se=p("right-toolbar"),ie=p("el-row"),b=p("el-table-column"),re=p("el-popover"),F=p("el-tag"),T=p("el-tooltip"),ue=p("el-table"),ce=p("pagination"),pe=p("el-dialog"),me=be("loading");return y(),we("div",Pe,[v.value?(y(),w(Ce,{key:0,settings:I.value,onHandleSearch:X},null,8,["settings"])):k("",!0),P("div",Ne,[a(ie,{gutter:10,class:"mb8"},{default:o(()=>[a(A,{span:1.5},{default:o(()=>[a(d,{type:"primary",plain:"",icon:"Plus",onClick:Z},{default:o(()=>[C("新增")]),_:1})]),_:1}),a(A,{span:1.5},{default:o(()=>[a(d,{type:"danger",plain:"",icon:"Delete",disabled:E.value,onClick:q},{default:o(()=>[C("删除")]),_:1},8,["disabled"])]),_:1}),a(se,{showSearch:v.value,"onUpdate:showSearch":t[0]||(t[0]=e=>v.value=e),onQueryTable:_},null,8,["showSearch"])]),_:1}),H((y(),w(ue,{data:s.tableData,onSelectionChange:Y},{default:o(()=>[a(b,{type:"selection",width:"50",align:"center"}),a(b,{label:"标题",align:"center",prop:"title"}),a(b,{label:"内容",align:"center",prop:"platform"},{default:o(e=>[a(re,{placement:"top",width:400},{reference:o(()=>[P("span",null,J(e.row.content.length>10?e.row.content.slice(0,10)+"...":e.row.content),1)]),default:o(()=>[P("span",null,J(e.row.content),1)]),_:2},1024)]),_:1}),a(b,{label:"处理状态",align:"center",prop:"status"},{default:o(e=>[e.row.status=="1"?(y(),w(F,{key:0,type:"success"},{default:o(()=>[C("已处理")]),_:1})):k("",!0),e.row.status=="0"?(y(),w(F,{key:1,type:"danger"},{default:o(()=>[C("未处理")]),_:1})):k("",!0)]),_:1}),k("",!0),a(b,{label:"创建时间",align:"center",prop:"createTime"}),a(b,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:o(e=>[a(T,{content:"修改",placement:"top"},{default:o(()=>[a(d,{link:"",type:"primary",icon:"Edit",onClick:U=>ee(e.row)},null,8,["onClick"])]),_:2},1024),a(T,{content:"删除",placement:"top"},{default:o(()=>[a(d,{link:"",type:"primary",icon:"Delete",onClick:U=>q(e.row)},null,8,["onClick"])]),_:2},1024),e.row.status=="0"?(y(),w(T,{key:0,content:"已处理",placement:"top"},{default:o(()=>[a(d,{link:"",type:"primary",icon:"CircleCheck",onClick:U=>te(e.row)},null,8,["onClick"])]),_:2},1024)):k("",!0),e.row.status=="1"?(y(),w(T,{key:1,content:"未处理",placement:"top"},{default:o(()=>[a(d,{link:"",type:"primary",icon:"CircleClose",onClick:U=>ae(e.row)},null,8,["onClick"])]),_:2},1024)):k("",!0)]),_:1})]),_:1},8,["data"])),[[me,D.value]]),H(a(ce,{total:s.total,page:c.value.pageNum,"onUpdate:page":t[1]||(t[1]=e=>c.value.pageNum=e),limit:c.value.pageSize,"onUpdate:limit":t[2]||(t[2]=e=>c.value.pageSize=e),onPagination:_},null,8,["total","page","limit"]),[[ke,s.total>0]])]),a(pe,{title:B.value,modelValue:h.value,"onUpdate:modelValue":t[4]||(t[4]=e=>h.value=e),width:"40%",onClosed:ne,draggable:"","destroy-on-close":!1},{footer:o(()=>[P("div",Ie,[a(d,{type:"primary",onClick:le},{default:o(()=>[C("确 定")]),_:1}),a(d,{onClick:oe},{default:o(()=>[C("取 消")]),_:1})])]),default:o(()=>[a(De,{settings:S.value,modelValue:s.formData,"onUpdate:modelValue":t[3]||(t[3]=e=>s.formData=e),ref_key:"base_form",ref:R},null,8,["settings","modelValue"])]),_:1},8,["title","modelValue"]),a(Be,{modelValue:$.value,"onUpdate:modelValue":t[5]||(t[5]=e=>$.value=e),size:"auto","img-list":K.value,title:Q.value,"init-number":G.value},null,8,["modelValue","img-list","title","init-number"])])}}}),Ae=_e(Ue,[["__scopeId","data-v-f0463a67"]]);export{Ae as default};
