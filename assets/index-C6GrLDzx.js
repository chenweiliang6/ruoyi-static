var We=Object.defineProperty,Xe=Object.defineProperties;var Ze=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var el=Object.prototype.hasOwnProperty,ll=Object.prototype.propertyIsEnumerable;var ue=(k,c,u)=>c in k?We(k,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):k[c]=u,re=(k,c)=>{for(var u in c||(c={}))el.call(c,u)&&ue(k,u,c[u]);if(se)for(var u of se(c))ll.call(c,u)&&ue(k,u,c[u]);return k},de=(k,c)=>Xe(k,Ze(c));var ie=(k,c,u)=>new Promise((E,O)=>{var z=V=>{try{T(u.next(V))}catch(N){O(N)}},x=V=>{try{T(u.throw(V))}catch(N){O(N)}},T=V=>V.done?E(V.value):Promise.resolve(V.value).then(z,x);T((u=u.apply(k,c)).next())});import{I as tl,a as al,g as ol,r as _,J as pe,a9 as nl,P as sl,w as ul,d,M as me,c as F,o as r,f as l,h as t,e as I,K as Y,i as a,N as w,j as ce,F as q,z as B,s as i,k as g,O as fe,l as y,A as _e}from"./index-LUiqg7zx.js";import{i as rl,l as dl,e as ve,f as il,j as pl,h as ml,r as cl,k as fl,m as _l}from"./user--Kbj0woh.js";import{e as be}from"./jsencrypt-nFvyCkrE.js";import{d as vl}from"./export-DRQPRSom.js";const bl={class:"app-container"},gl={class:"head-container"},hl={class:"head-container"},yl={class:"dialog-footer"},kl=I("div",{class:"el-upload__text"},[g("将文件拖到此处，或"),I("em",null,"点击上传")],-1),Vl={class:"el-upload__tip text-center"},wl={class:"el-upload__tip"},xl=I("span",null,"仅允许导入xls、xlsx格式文件。",-1),Il={class:"dialog-footer"},Ul=tl({name:"User"}),Tl=Object.assign(Ul,{setup(k){const c=al(),{proxy:u}=ol(),{sys_normal_disable:E,sys_user_sex:O}=u.useDict("sys_normal_disable","sys_user_sex"),z=_([]),x=_(!1),T=_(!0),V=_(!0),N=_([]),ee=_(!0),le=_(!0),H=_(0),Q=_(""),D=_([]),L=_(""),J=_(void 0),ge=_(void 0),G=_([]),W=_([]),h=pe({open:!1,title:"",isUploading:!1,updateSupport:0,headers:{Authorization:"Bearer "+nl()},url:"/ruoyi/system/user/importData"}),C=_([{key:0,label:"用户编号",visible:!0},{key:1,label:"用户名称",visible:!0},{key:2,label:"用户昵称",visible:!0},{key:3,label:"部门",visible:!0},{key:4,label:"手机号码",visible:!0},{key:5,label:"状态",visible:!0},{key:6,label:"创建时间",visible:!0}]),he=pe({form:{},queryParams:{pageNum:1,pageSize:10,userName:void 0,phonenumber:void 0,status:void 0,deptId:void 0},rules:{userName:[{required:!0,message:"用户名称不能为空",trigger:"blur"},{min:2,max:20,message:"用户名称长度必须介于 2 和 20 之间",trigger:"blur"}],nickName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],password:[{required:!0,message:"用户密码不能为空",trigger:"blur"},{min:5,max:20,message:"用户密码长度必须介于 5 和 20 之间",trigger:"blur"},{pattern:/^[^<>"'|\\]+$/,message:`不能包含非法字符：< > " ' \\ |`,trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],phonenumber:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}]}}),{queryParams:v,form:s,rules:ye}=sl(he),ke=(n,o)=>n?o.label.indexOf(n)!==-1:!0;ul(L,n=>{u.$refs.deptTreeRef.filter(n)});function Ve(){rl().then(n=>{J.value=n.data})}function S(){T.value=!0,dl(de(re({},v.value),{startTime:D.value[0],endTime:D.value[1]})).then(n=>{T.value=!1,z.value=n.rows,H.value=n.total})}function we(n){v.value.deptId=n.id,K()}function K(){v.value.pageNum=1,S()}function xe(){D.value=[],u.resetForm("queryRef"),v.value.deptId=void 0,u.$refs.deptTreeRef.setCurrentKey(null),K()}function te(n){const o=n.userId||N.value;u.$modal.confirm('是否确认删除用户编号为"'+o+'"的数据项？').then(function(){return il(o)}).then(()=>{S(),u.$modal.msgSuccess("删除成功")}).catch(()=>{})}function Ie(){return ie(this,null,function*(){let n={};N.value.forEach((p,Z)=>{n[Z]=p});let o=yield pl(n);vl(o)})}function Ue(n){let o=n.status==="0"?"启用":"停用";u.$modal.confirm('确认要"'+o+'""'+n.userName+'"用户吗?').then(function(){return ml(n.userId,n.status)}).then(()=>{u.$modal.msgSuccess(o+"成功")}).catch(function(){n.status=n.status==="0"?"1":"0"})}function Ne(n){const o=n.userId;c.push("/system/user-auth/role/"+o)}function Ce(n){u.$prompt('请输入"'+n.userName+'"的新密码',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputPattern:/^.{5,20}$/,inputErrorMessage:"用户密码长度必须介于 5 和 20 之间",inputValidator:o=>{if(/<|>|"|'|\||\\/.test(o))return`不能包含非法字符：< > " ' \\ |`}}).then(({value:o})=>{cl(n.userId,be(o)).then(p=>{u.$modal.msgSuccess("修改成功，新密码是："+o)})}).catch(()=>{})}function Se(n){N.value=n.map(o=>o.userId),ee.value=n.length!=1,le.value=!n.length}function $e(){u.download("system/user/importTemplate",{},`user_template_${new Date().getTime()}.xlsx`)}const Re=(n,o,p)=>{h.isUploading=!0},Te=(n,o,p)=>{h.open=!1,h.isUploading=!1,u.$refs.uploadRef.handleRemove(o),u.$alert("<div style='overflow: auto;overflow-x: hidden;max-height: 70vh;padding: 10px 20px 0;'>"+n.msg+"</div>","导入结果",{dangerouslyUseHTMLString:!0}),S()};function De(){u.$refs.uploadRef.submit()}function X(){s.value={userId:void 0,deptId:void 0,userName:void 0,nickName:void 0,password:void 0,phonenumber:void 0,email:void 0,sex:void 0,status:"0",remark:void 0,postIds:[],roleIds:[]},u.resetForm("userRef")}function Pe(){x.value=!1,X()}function Fe(){X(),ve().then(n=>{G.value=n.posts,W.value=n.roles,x.value=!0,Q.value="添加用户",s.value.password=ge.value})}function ae(n){X();const o=n.userId||N.value;ve(o).then(p=>{s.value=p.data,G.value=p.posts,W.value=p.roles,s.value.postIds=p.postIds,s.value.roleIds=p.roleIds,x.value=!0,Q.value="修改用户",s.password=""})}function Ke(){u.$refs.userRef.validate(n=>{n&&(s.value.userId!=null?fl(s.value).then(o=>{u.$modal.msgSuccess("修改成功"),x.value=!1,S()}):(s.value.password=be(s.value.password),_l(s.value).then(o=>{u.$modal.msgSuccess("新增成功"),x.value=!1,S()})))})}return Ve(),S(),(n,o)=>{const p=d("el-input"),Z=d("el-tree"),m=d("el-col"),f=d("el-form-item"),M=d("el-option"),j=d("el-select"),qe=d("el-date-picker"),b=d("el-button"),oe=d("el-form"),Be=d("right-toolbar"),$=d("el-row"),U=d("el-table-column"),Ee=d("el-switch"),A=d("el-tooltip"),Oe=d("el-table"),ze=d("pagination"),Le=d("el-tree-select"),Me=d("el-radio"),je=d("el-radio-group"),ne=d("el-dialog"),Ae=d("upload-filled"),Ye=d("el-icon"),He=d("el-checkbox"),Qe=d("el-link"),Je=d("el-upload"),R=me("hasPermi"),Ge=me("loading");return r(),F("div",bl,[l($,{gutter:20},{default:t(()=>[l(m,{span:4,xs:24},{default:t(()=>[I("div",gl,[l(p,{modelValue:a(L),"onUpdate:modelValue":o[0]||(o[0]=e=>Y(L)?L.value=e:null),placeholder:"请输入部门名称",clearable:"","prefix-icon":"Search",style:{"margin-bottom":"20px"}},null,8,["modelValue"])]),I("div",hl,[l(Z,{data:a(J),props:{label:"label",children:"children"},"expand-on-click-node":!1,"filter-node-method":ke,ref:"deptTreeRef","node-key":"id","highlight-current":"","default-expand-all":"",onNodeClick:we},null,8,["data"])])]),_:1}),l(m,{span:20,xs:24},{default:t(()=>[w(l(oe,{model:a(v),ref:"queryRef",inline:!0,"label-width":"68px"},{default:t(()=>[l(f,{label:"用户名称",prop:"userName"},{default:t(()=>[l(p,{modelValue:a(v).userName,"onUpdate:modelValue":o[1]||(o[1]=e=>a(v).userName=e),placeholder:"请输入用户名称",clearable:"",style:{width:"240px"},onKeyup:ce(K,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),l(f,{label:"手机号码",prop:"phonenumber"},{default:t(()=>[l(p,{modelValue:a(v).phonenumber,"onUpdate:modelValue":o[2]||(o[2]=e=>a(v).phonenumber=e),placeholder:"请输入手机号码",clearable:"",style:{width:"240px"},onKeyup:ce(K,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),l(f,{label:"状态",prop:"status"},{default:t(()=>[l(j,{modelValue:a(v).status,"onUpdate:modelValue":o[3]||(o[3]=e=>a(v).status=e),placeholder:"用户状态",clearable:"",style:{width:"240px"}},{default:t(()=>[(r(!0),F(q,null,B(a(E),e=>(r(),i(M,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"创建时间",style:{width:"308px"}},{default:t(()=>[l(qe,{modelValue:a(D),"onUpdate:modelValue":o[4]||(o[4]=e=>Y(D)?D.value=e:null),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),l(f,null,{default:t(()=>[l(b,{type:"primary",icon:"Search",onClick:K},{default:t(()=>[g("搜索")]),_:1}),l(b,{icon:"Refresh",onClick:xe},{default:t(()=>[g("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[fe,a(V)]]),l($,{gutter:10,class:"mb8"},{default:t(()=>[l(m,{span:1.5},{default:t(()=>[w((r(),i(b,{type:"primary",plain:"",icon:"Plus",onClick:Fe},{default:t(()=>[g("新增")]),_:1})),[[R,["system:user:add"]]])]),_:1}),l(m,{span:1.5},{default:t(()=>[w((r(),i(b,{type:"success",plain:"",icon:"Edit",disabled:a(ee),onClick:ae},{default:t(()=>[g("修改")]),_:1},8,["disabled"])),[[R,["system:user:edit"]]])]),_:1}),l(m,{span:1.5},{default:t(()=>[w((r(),i(b,{type:"danger",plain:"",icon:"Delete",disabled:a(le),onClick:te},{default:t(()=>[g("删除")]),_:1},8,["disabled"])),[[R,["system:user:remove"]]])]),_:1}),l(m,{span:1.5},{default:t(()=>[w((r(),i(b,{type:"warning",plain:"",icon:"Download",onClick:Ie},{default:t(()=>[g("导出")]),_:1})),[[R,["system:user:export"]]])]),_:1}),l(Be,{showSearch:a(V),"onUpdate:showSearch":o[5]||(o[5]=e=>Y(V)?V.value=e:null),onQueryTable:S,columns:a(C)},null,8,["showSearch","columns"])]),_:1}),w((r(),i(Oe,{data:a(z),onSelectionChange:Se},{default:t(()=>[l(U,{type:"selection",width:"50",align:"center"}),a(C)[0].visible?(r(),i(U,{label:"用户编号",align:"center",key:"userId",prop:"userId"})):y("",!0),a(C)[1].visible?(r(),i(U,{label:"用户名称",align:"center",key:"userName",prop:"userName","show-overflow-tooltip":!0})):y("",!0),a(C)[2].visible?(r(),i(U,{label:"用户昵称",align:"center",key:"nickName",prop:"nickName","show-overflow-tooltip":!0})):y("",!0),a(C)[3].visible?(r(),i(U,{label:"部门",align:"center",key:"deptName",prop:"dept.deptName","show-overflow-tooltip":!0})):y("",!0),a(C)[4].visible?(r(),i(U,{label:"手机号码",align:"center",key:"phonenumber",prop:"phonenumber",width:"120"})):y("",!0),a(C)[5].visible?(r(),i(U,{label:"状态",align:"center",key:"status"},{default:t(e=>[l(Ee,{modelValue:e.row.status,"onUpdate:modelValue":P=>e.row.status=P,"active-value":"0","inactive-value":"1",onChange:P=>Ue(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):y("",!0),a(C)[6].visible?(r(),i(U,{key:6,label:"创建时间",align:"center",prop:"createTime",width:"160"},{default:t(e=>[I("span",null,_e(n.parseTime(e.row.createTime)),1)]),_:1})):y("",!0),l(U,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:t(e=>[e.row.userId!==1?(r(),i(A,{key:0,content:"修改",placement:"top"},{default:t(()=>[w(l(b,{link:"",type:"primary",icon:"Edit",onClick:P=>ae(e.row)},null,8,["onClick"]),[[R,["system:user:edit"]]])]),_:2},1024)):y("",!0),e.row.userId!==1?(r(),i(A,{key:1,content:"删除",placement:"top"},{default:t(()=>[w(l(b,{link:"",type:"primary",icon:"Delete",onClick:P=>te(e.row)},null,8,["onClick"]),[[R,["system:user:remove"]]])]),_:2},1024)):y("",!0),e.row.userId!==1?(r(),i(A,{key:2,content:"重置密码",placement:"top"},{default:t(()=>[w(l(b,{link:"",type:"primary",icon:"Key",onClick:P=>Ce(e.row)},null,8,["onClick"]),[[R,["system:user:resetPwd"]]])]),_:2},1024)):y("",!0),e.row.userId!==1?(r(),i(A,{key:3,content:"分配角色",placement:"top"},{default:t(()=>[w(l(b,{link:"",type:"primary",icon:"CircleCheck",onClick:P=>Ne(e.row)},null,8,["onClick"]),[[R,["system:user:edit"]]])]),_:2},1024)):y("",!0)]),_:1})]),_:1},8,["data"])),[[Ge,a(T)]]),w(l(ze,{total:a(H),page:a(v).pageNum,"onUpdate:page":o[6]||(o[6]=e=>a(v).pageNum=e),limit:a(v).pageSize,"onUpdate:limit":o[7]||(o[7]=e=>a(v).pageSize=e),onPagination:S},null,8,["total","page","limit"]),[[fe,a(H)>0]])]),_:1})]),_:1}),l(ne,{title:a(Q),modelValue:a(x),"onUpdate:modelValue":o[19]||(o[19]=e=>Y(x)?x.value=e:null),width:"600px","append-to-body":""},{footer:t(()=>[I("div",yl,[l(b,{type:"primary",onClick:Ke},{default:t(()=>[g("确 定")]),_:1}),l(b,{onClick:Pe},{default:t(()=>[g("取 消")]),_:1})])]),default:t(()=>[l(oe,{model:a(s),rules:a(ye),ref:"userRef","label-width":"80px"},{default:t(()=>[l($,null,{default:t(()=>[l(m,{span:12},{default:t(()=>[l(f,{label:"用户昵称",prop:"nickName"},{default:t(()=>[l(p,{modelValue:a(s).nickName,"onUpdate:modelValue":o[8]||(o[8]=e=>a(s).nickName=e),placeholder:"请输入用户昵称",maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:12},{default:t(()=>[l(f,{label:"归属部门",prop:"deptId"},{default:t(()=>[l(Le,{modelValue:a(s).deptId,"onUpdate:modelValue":o[9]||(o[9]=e=>a(s).deptId=e),data:a(J),props:{value:"id",label:"label",children:"children"},"value-key":"id",placeholder:"请选择归属部门","check-strictly":""},null,8,["modelValue","data"])]),_:1})]),_:1})]),_:1}),l($,null,{default:t(()=>[l(m,{span:12},{default:t(()=>[l(f,{label:"手机号码",prop:"phonenumber"},{default:t(()=>[l(p,{modelValue:a(s).phonenumber,"onUpdate:modelValue":o[10]||(o[10]=e=>a(s).phonenumber=e),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:12},{default:t(()=>[l(f,{label:"邮箱",prop:"email"},{default:t(()=>[l(p,{modelValue:a(s).email,"onUpdate:modelValue":o[11]||(o[11]=e=>a(s).email=e),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l($,null,{default:t(()=>[l(m,{span:12},{default:t(()=>[a(s).userId==null?(r(),i(f,{key:0,label:"用户名称",prop:"userName"},{default:t(()=>[l(p,{modelValue:a(s).userName,"onUpdate:modelValue":o[12]||(o[12]=e=>a(s).userName=e),placeholder:"请输入用户名称",maxlength:"30"},null,8,["modelValue"])]),_:1})):y("",!0)]),_:1}),l(m,{span:12},{default:t(()=>[a(s).userId==null?(r(),i(f,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(p,{modelValue:a(s).password,"onUpdate:modelValue":o[13]||(o[13]=e=>a(s).password=e),placeholder:"请输入用户密码",type:"password",maxlength:"20","show-password":""},null,8,["modelValue"])]),_:1})):y("",!0)]),_:1})]),_:1}),l($,null,{default:t(()=>[l(m,{span:12},{default:t(()=>[l(f,{label:"用户性别"},{default:t(()=>[l(j,{modelValue:a(s).sex,"onUpdate:modelValue":o[14]||(o[14]=e=>a(s).sex=e),placeholder:"请选择"},{default:t(()=>[(r(!0),F(q,null,B(a(O),e=>(r(),i(M,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{span:12},{default:t(()=>[l(f,{label:"状态"},{default:t(()=>[l(je,{modelValue:a(s).status,"onUpdate:modelValue":o[15]||(o[15]=e=>a(s).status=e)},{default:t(()=>[(r(!0),F(q,null,B(a(E),e=>(r(),i(Me,{key:e.value,label:e.value},{default:t(()=>[g(_e(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l($,null,{default:t(()=>[l(m,{span:12},{default:t(()=>[l(f,{label:"岗位"},{default:t(()=>[l(j,{modelValue:a(s).postIds,"onUpdate:modelValue":o[16]||(o[16]=e=>a(s).postIds=e),multiple:"",placeholder:"请选择"},{default:t(()=>[(r(!0),F(q,null,B(a(G),e=>(r(),i(M,{key:e.postId,label:e.postName,value:e.postId,disabled:e.status==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{span:12},{default:t(()=>[l(f,{label:"角色"},{default:t(()=>[l(j,{modelValue:a(s).roleIds,"onUpdate:modelValue":o[17]||(o[17]=e=>a(s).roleIds=e),multiple:"",placeholder:"请选择"},{default:t(()=>[(r(!0),F(q,null,B(a(W),e=>(r(),i(M,{key:e.roleId,label:e.roleName,value:e.roleId,disabled:e.status==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l($,null,{default:t(()=>[l(m,{span:24},{default:t(()=>[l(f,{label:"备注"},{default:t(()=>[l(p,{modelValue:a(s).remark,"onUpdate:modelValue":o[18]||(o[18]=e=>a(s).remark=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),l(ne,{title:a(h).title,modelValue:a(h).open,"onUpdate:modelValue":o[22]||(o[22]=e=>a(h).open=e),width:"400px","append-to-body":""},{footer:t(()=>[I("div",Il,[l(b,{type:"primary",onClick:De},{default:t(()=>[g("确 定")]),_:1}),l(b,{onClick:o[21]||(o[21]=e=>a(h).open=!1)},{default:t(()=>[g("取 消")]),_:1})])]),default:t(()=>[l(Je,{ref:"uploadRef",limit:1,accept:".xlsx, .xls",headers:a(h).headers,action:a(h).url+"?updateSupport="+a(h).updateSupport,disabled:a(h).isUploading,"on-progress":Re,"on-success":Te,"auto-upload":!1,drag:""},{tip:t(()=>[I("div",Vl,[I("div",wl,[l(He,{modelValue:a(h).updateSupport,"onUpdate:modelValue":o[20]||(o[20]=e=>a(h).updateSupport=e)},null,8,["modelValue"]),g("是否更新已经存在的用户数据 ")]),xl,l(Qe,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:$e},{default:t(()=>[g("下载模板")]),_:1})])]),default:t(()=>[l(Ye,{class:"el-icon--upload"},{default:t(()=>[l(Ae)]),_:1}),kl]),_:1},8,["headers","action","disabled"])]),_:1},8,["title","modelValue"])])}}});export{Tl as default};
