var ge=Object.defineProperty;var Q=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var Y=(s,c,r)=>c in s?ge(s,c,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[c]=r,E=(s,c)=>{for(var r in c||(c={}))ye.call(c,r)&&Y(s,r,c[r]);if(Q)for(var r of Q(c))ve.call(c,r)&&Y(s,r,c[r]);return s};var m=(s,c,r)=>new Promise((V,x)=>{var o=d=>{try{b(r.next(d))}catch(y){x(y)}},I=d=>{try{b(r.throw(d))}catch(y){x(y)}},b=d=>d.done?V(d.value):Promise.resolve(d.value).then(o,I);b((r=r.apply(s,c)).next())});import{y as N,_ as he,g as _e,r as i,J as be,x as we,Y as ke,d as g,M as Ce,c as B,o as p,s as w,l as D,e as R,f as l,N as G,h as n,k,A as Se,O as De,E as M,D as v}from"./index-LUiqg7zx.js";import xe from"./index-BzwtcKOi.js";import Ie from"./index-Bc25mPWH.js";import Te from"./index-CegAYL2H.js";import{g as Pe}from"./user--Kbj0woh.js";import{d as Be}from"./export-DRQPRSom.js";import"./index-CPEdGia4.js";function Ne(s){let c={pageNum:s.pageNum,pageSize:s.pageSize};return N({url:"/account/list",method:"post",data:s,params:c})}function Ve(s){return N({url:"/account/add",method:"post",data:s})}function q(s){return N({url:"/account/update",method:"put",data:s})}function Ue(s){return N({url:"/account/"+s.accountId,method:"delete"})}function Ee(s){return N({url:"/account/export",method:"post",data:s,responseType:"blob"})}const Ae={class:"app-container"},$e={class:"list-container"},ze=["src","onClick"],Re={key:1},Me=["src","onClick"],qe={key:1},Le={class:"dialog-footer"},Fe={__name:"index",setup(s){const{proxy:c}=_e(),{sys_buy_platform:r}=c.useDict("sys_buy_platform"),V=i([{type:"input",prop:"tradeName",label:"购买商品名称",placeholder:"请输入购买商品名称"},{type:"select",prop:"platform",label:"购买平台",placeholder:"请选择购买平台",options:[]},{type:"select",prop:"status",label:"报账状态",placeholder:"请选择报账状态",options:[{label:"未报账",value:"0"},{label:"已报账",value:"1"}]},{type:"date",dateType:"daterange",prop:"timeRange",label:"购买时间",startPlaceholder:"开始日期",endPlaceholder:"结束日期"}]),x=i([{type:"input",prop:"tradeName",label:"购买商品名称",width:12,formItemProps:{placeholder:"请输入购买商品名称"},rule:[{required:!0,message:"请输入购买商品名称",trigger:"blur"}]},{type:"select",prop:"platform",label:"购买平台",width:12,formItemProps:{placeholder:"请选择购买平台"},options:[],rule:[{required:!0,message:"请选择购买平台",trigger:"change"}]},{type:"input",prop:"money",label:"购买金额",width:12,formItemProps:{placeholder:"请输入购买金额"},rule:[{required:!0,message:"请输入购买金额",trigger:"blur"}]},{type:"select",prop:"status",label:"报账状态",width:12,formItemProps:{placeholder:"请选择报账状态"},options:[{value:"0",label:"未报账"},{value:"1",label:"已报账"}]},{type:"upload",uploadType:"img",listType:"picture-card",limit:1,prop:"buyShots",label:"购买截图",width:12,formItemProps:{placeholder:"请上传购买截图"}},{type:"upload",uploadType:"img",listType:"picture-card",limit:1,prop:"invoices",label:"发票",width:12,formItemProps:{placeholder:"请上传发票"}},{type:"date",dateType:"date",prop:"buyTime",label:"购买时间",width:12,formItemProps:{placeholder:"请选择购买时间"}}]),o=be({tableData:[],total:0,formData:{}}),I=i([]),b=i(!0),d=i(!1),y=i({pageNum:1,pageSize:10}),C=i({}),T=i(!1),L=i(!0),A=i({}),P=i(""),S=i(!1),F=i(null),$=i(!1),j=i(""),W=i("0"),H=i([]),X=()=>m(this,null,function*(){let e=yield Pe();A.value=e.data}),h=()=>m(this,null,function*(){T.value=!0;try{A.value.roles.some(t=>t.roleKey=="admin")?d.value=!0:(C.value.createBy=A.value.userName,d.value=!1);let e=yield Ne(E(E({},y.value),C.value));o.tableData=e.rows,o.total=e.total,T.value=!1}catch(e){T.value=!1}}),Z=e=>m(this,null,function*(){var t;T.value=!0,C.value=e,(t=e.timeRange)!=null&&t.length&&(C.value.startTime=e.timeRange[0],C.value.endTime=e.timeRange[1].split(" ")[0]+" 23:59:59"),delete C.value.timeRange,h()}),ee=e=>{I.value=e.map(t=>t.accountId),L.value=!e.length},te=()=>{P.value="新增报账信息",S.value=!0},ae=e=>{P.value="修改报账信息",S.value=!0,o.formData=E({},e),o.formData.buyShots=[{url:o.formData.buyShot}],o.formData.invoices=[{url:o.formData.invoice}]},le=()=>m(this,null,function*(){let e={};e.ids=I.value;let t=yield Ee(e);Be(t,"报账信息.xlsx")}),J=e=>{M.confirm("是否确认删除该报账信息？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>m(this,null,function*(){let t=e.accountId||I.value;yield Ue({accountId:t}),h(),v({type:"success",message:"删除成功"})})).catch(()=>{v({type:"info",message:"取消删除"})})},oe=e=>{M.confirm("是否将状态改为已报账？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>m(this,null,function*(){let t=e.accountId;yield q({accountId:t,status:"1"}),h(),v({type:"success",message:"更改成功"})})).catch(()=>{v({type:"info",message:"取消更改"})})},ne=e=>{M.confirm("是否将状态改为未报账？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>m(this,null,function*(){let t=e.accountId;yield q({accountId:t,status:"0"}),h(),v({type:"success",message:"更改成功"})})).catch(()=>{v({type:"info",message:"取消更改"})})},se=()=>m(this,null,function*(){F.value.submitRef().then(e=>m(this,null,function*(){var t,u;e&&(S.value=!1,o.formData.buyShot=(t=o.formData.buyShots)!=null&&t.length?o.formData.buyShots[0].url:"",o.formData.invoice=(u=o.formData.invoices)!=null&&u.length?o.formData.invoices[0].url:"",delete o.formData.buyShots,delete o.formData.invoices,P.value=="新增报账信息"?(yield Ve(o.formData),v.success("新增成功")):P.value=="修改报账信息"&&(yield q(o.formData),v.success("修改成功")),h())}))}),re=()=>{S.value=!1,v.info("取消")},ie=()=>{o.formData={}},K=(e,t)=>{H.value=[{url:e}],j.value=t,$.value=!0};return we(()=>m(this,null,function*(){yield X(),yield h()})),ke(()=>{V.value.find(e=>e.prop=="platform").options=r.value,x.value.find(e=>e.prop=="platform").options=r.value}),(e,t)=>{const u=g("el-button"),z=g("el-col"),ce=g("right-toolbar"),ue=g("el-row"),f=g("el-table-column"),O=g("el-tag"),U=g("el-tooltip"),pe=g("el-table"),de=g("pagination"),me=g("el-dialog"),fe=Ce("loading");return p(),B("div",Ae,[b.value?(p(),w(xe,{key:0,settings:V.value,onHandleSearch:Z},null,8,["settings"])):D("",!0),R("div",$e,[l(ue,{gutter:10,class:"mb8"},{default:n(()=>[l(z,{span:1.5},{default:n(()=>[l(u,{type:"primary",plain:"",icon:"Plus",onClick:te},{default:n(()=>[k("新增")]),_:1})]),_:1}),l(z,{span:1.5},{default:n(()=>[l(u,{type:"danger",plain:"",icon:"Delete",disabled:L.value,onClick:J},{default:n(()=>[k("删除")]),_:1},8,["disabled"])]),_:1}),l(z,{span:1.5},{default:n(()=>[l(u,{type:"warning",plain:"",icon:"Download",onClick:le},{default:n(()=>[k("导出")]),_:1})]),_:1}),l(ce,{showSearch:b.value,"onUpdate:showSearch":t[0]||(t[0]=a=>b.value=a),onQueryTable:h},null,8,["showSearch"])]),_:1}),G((p(),w(pe,{data:o.tableData,onSelectionChange:ee},{default:n(()=>[l(f,{type:"selection",width:"50",align:"center"}),l(f,{label:"购买商品名称",align:"center",prop:"tradeName"}),l(f,{label:"购买平台",align:"center",prop:"platform"}),l(f,{label:"购买金额",align:"center",prop:"money"}),l(f,{label:"购买截图",align:"center",prop:"buyShot"},{default:n(a=>[a.row.buyShot?(p(),B("img",{key:0,src:a.row.buyShot,style:{width:"60px",height:"60px",cursor:"pointer"},onClick:_=>K(a.row.buyShot,"购买截图")},null,8,ze)):(p(),B("span",Re,"暂无"))]),_:1}),l(f,{label:"发票",align:"center",prop:"invoice"},{default:n(a=>[a.row.invoice?(p(),B("img",{key:0,src:a.row.invoice,style:{width:"60px",height:"60px",cursor:"pointer"},onClick:_=>K(a.row.invoice,"发票")},null,8,Me)):(p(),B("span",qe,"暂无"))]),_:1}),l(f,{label:"报账状态",align:"center",prop:"status"},{default:n(a=>[a.row.status=="1"?(p(),w(O,{key:0,type:"success"},{default:n(()=>[k("已报账")]),_:1})):D("",!0),a.row.status=="0"?(p(),w(O,{key:1,type:"danger"},{default:n(()=>[k("未报账")]),_:1})):D("",!0)]),_:1}),l(f,{label:"购买时间",align:"center",prop:"buyTime",width:"160"},{default:n(a=>{var _;return[R("span",null,Se(((_=a.row.buyTime)==null?void 0:_.split(" ")[0])||"暂无"),1)]}),_:1}),d.value?(p(),w(f,{key:0,label:"创建人",align:"center",prop:"createBy"})):D("",!0),l(f,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:n(a=>[l(U,{content:"修改",placement:"top"},{default:n(()=>[l(u,{link:"",type:"primary",icon:"Edit",onClick:_=>ae(a.row)},null,8,["onClick"])]),_:2},1024),l(U,{content:"删除",placement:"top"},{default:n(()=>[l(u,{link:"",type:"primary",icon:"Delete",onClick:_=>J(a.row)},null,8,["onClick"])]),_:2},1024),a.row.status=="0"?(p(),w(U,{key:0,content:"已报账",placement:"top"},{default:n(()=>[l(u,{link:"",type:"primary",icon:"CircleCheck",onClick:_=>oe(a.row)},null,8,["onClick"])]),_:2},1024)):D("",!0),a.row.status=="1"?(p(),w(U,{key:1,content:"未报账",placement:"top"},{default:n(()=>[l(u,{link:"",type:"primary",icon:"CircleClose",onClick:_=>ne(a.row)},null,8,["onClick"])]),_:2},1024)):D("",!0)]),_:1})]),_:1},8,["data"])),[[fe,T.value]]),G(l(de,{total:o.total,page:y.value.pageNum,"onUpdate:page":t[1]||(t[1]=a=>y.value.pageNum=a),limit:y.value.pageSize,"onUpdate:limit":t[2]||(t[2]=a=>y.value.pageSize=a),onPagination:h},null,8,["total","page","limit"]),[[De,o.total>0]])]),l(me,{title:P.value,modelValue:S.value,"onUpdate:modelValue":t[4]||(t[4]=a=>S.value=a),width:"40%",onClosed:ie,draggable:"","destroy-on-close":!0},{footer:n(()=>[R("div",Le,[l(u,{type:"primary",onClick:se},{default:n(()=>[k("确 定")]),_:1}),l(u,{onClick:re},{default:n(()=>[k("取 消")]),_:1})])]),default:n(()=>[l(Ie,{settings:x.value,modelValue:o.formData,"onUpdate:modelValue":t[3]||(t[3]=a=>o.formData=a),ref_key:"base_form",ref:F},null,8,["settings","modelValue"])]),_:1},8,["title","modelValue"]),l(Te,{modelValue:$.value,"onUpdate:modelValue":t[5]||(t[5]=a=>$.value=a),size:"auto","img-list":H.value,title:j.value,"init-number":W.value},null,8,["modelValue","img-list","title","init-number"])])}}},We=he(Fe,[["__scopeId","data-v-739e227b"]]);export{We as default};
