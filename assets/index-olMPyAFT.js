var el=Object.defineProperty,ll=Object.defineProperties;var tl=Object.getOwnPropertyDescriptors;var ve=Object.getOwnPropertySymbols;var al=Object.prototype.hasOwnProperty,ol=Object.prototype.propertyIsEnumerable;var ye=(h,c,r)=>c in h?el(h,c,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[c]=r,he=(h,c)=>{for(var r in c||(c={}))al.call(c,r)&&ye(h,r,c[r]);if(ve)for(var r of ve(c))ol.call(c,r)&&ye(h,r,c[r]);return h},_e=(h,c)=>ll(h,tl(c));var ge=(h,c,r)=>new Promise((L,$)=>{var b=_=>{try{V(r.next(_))}catch(U){$(U)}},E=_=>{try{V(r.throw(_))}catch(U){$(U)}},V=_=>_.done?L(_.value):Promise.resolve(_.value).then(b,E);V((r=r.apply(h,c)).next())});import{I as nl,a as ul,g as dl,r as i,J as rl,P as sl,d as s,M as ke,c as J,o as f,N as g,f as t,O as ae,i as a,h as o,j as be,F as oe,z as ne,s as k,K as N,k as m,e as G,A as Ve,l as W,L as X}from"./index-CUeo8D_D.js";import{l as il,g as Ce,e as pl,f as ml,h as cl,i as fl,j as vl,k as yl,m as hl}from"./role-By2f9poD.js";import{t as _l,r as gl}from"./menu-CE86QbWH.js";import{d as kl}from"./export-DRQPRSom.js";const bl={class:"app-container"},Vl={class:"dialog-footer"},Cl={class:"dialog-footer"},Sl=nl({name:"Role"}),Il=Object.assign(Sl,{setup(h){const c=ul(),{proxy:r}=dl(),{sys_normal_disable:L}=r.useDict("sys_normal_disable"),$=i([]),b=i(!1),E=i(!0),V=i(!0),_=i([]),U=i(!0),ue=i(!0),Z=i(0),M=i(""),I=i([]),q=i([]),z=i(!1),F=i(!1),O=i(!0),j=i(!1),B=i([]),R=i(!1),C=i(null),S=i(null),Se=i([{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}]),we=rl({form:{},queryParams:{pageNum:1,pageSize:10,roleName:void 0,roleKey:void 0,status:void 0},rules:{roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleKey:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],roleSort:[{required:!0,message:"角色顺序不能为空",trigger:"blur"}]}}),{queryParams:y,form:u,rules:Ke}=sl(we);function w(){E.value=!0,il(_e(he({},y.value),{startTime:I.value[0],endTime:I.value[1]})).then(n=>{$.value=n.rows,Z.value=n.total,E.value=!1})}function Y(){y.value.pageNum=1,w()}function xe(){I.value=[],r.resetForm("queryRef"),Y()}function de(n){const e=n.roleId||_.value;r.$modal.confirm('是否确认删除角色编号为"'+e+'"的数据项?').then(function(){return pl(e)}).then(()=>{w(),r.$modal.msgSuccess("删除成功")}).catch(()=>{})}function Ne(){return ge(this,null,function*(){let n={};_.value.forEach((p,d)=>{n[d]=p});let e=yield ml(n);kl(e)})}function Ue(n){_.value=n.map(e=>e.roleId),U.value=n.length!=1,ue.value=!n.length}function Ie(n){let e=n.status==="0"?"启用":"停用";r.$modal.confirm('确认要"'+e+'""'+n.roleName+'"角色吗?').then(function(){return cl(n.roleId,n.status)}).then(()=>{r.$modal.msgSuccess(e+"成功")}).catch(function(){n.status=n.status==="0"?"1":"0"})}function Re(n){c.push("/system/role-auth/user/"+n.roleId)}function Te(){_l().then(n=>{q.value=n.data})}function De(){let n=S.value.getCheckedKeys(),e=S.value.getHalfCheckedKeys();return n.unshift.apply(n,e),n}function A(){C.value!=null&&C.value.setCheckedKeys([]),z.value=!1,F.value=!1,O.value=!0,j.value=!1,u.value={roleId:void 0,roleName:void 0,roleKey:void 0,roleSort:0,status:"0",menuIds:[],deptIds:[],menuCheckStrictly:!0,deptCheckStrictly:!0,remark:void 0},r.resetForm("roleRef")}function $e(){A(),Te(),b.value=!0,M.value="添加角色"}function re(n){A();const e=n.roleId||_.value,p=Ee(e);Ce(e).then(d=>{u.value=d.data,u.value.roleSort=Number(u.value.roleSort),b.value=!0,X(()=>{p.then(Q=>{Q.checkedKeys.forEach(le=>{X(()=>{C.value.setChecked(le,!0,!1)})})})}),M.value="修改角色"})}function Ee(n){return gl(n).then(e=>(q.value=e.menus,e))}function Me(n){return hl(n).then(e=>(B.value=e.depts,e))}function se(n,e){if(e=="menu"){let p=q.value;for(let d=0;d<p.length;d++)C.value.store.nodesMap[p[d].id].expanded=n}else if(e=="dept"){let p=B.value;for(let d=0;d<p.length;d++)S.value.store.nodesMap[p[d].id].expanded=n}}function ie(n,e){e=="menu"?C.value.setCheckedNodes(n?q.value:[]):e=="dept"&&S.value.setCheckedNodes(n?B.value:[])}function pe(n,e){e=="menu"?u.value.menuCheckStrictly=!!n:e=="dept"&&(u.value.deptCheckStrictly=!!n)}function me(){let n=C.value.getCheckedKeys(),e=C.value.getHalfCheckedKeys();return n.unshift.apply(n,e),n}function qe(){r.$refs.roleRef.validate(n=>{n&&(u.value.roleId!=null?(u.value.menuIds=me(),fl(u.value).then(e=>{r.$modal.msgSuccess("修改成功"),b.value=!1,w()})):(u.value.menuIds=me(),vl(u.value).then(e=>{r.$modal.msgSuccess("新增成功"),b.value=!1,w()})))})}function Ae(){b.value=!1,A()}function Pe(n){n!=="2"&&S.value.setCheckedKeys([])}function Le(n){A();const e=Me(n.roleId);Ce(n.roleId).then(p=>{u.value=p.data,R.value=!0,X(()=>{e.then(d=>{X(()=>{S.value&&S.value.setCheckedKeys(d.checkedKeys)})})}),M.value="分配数据权限"})}function ze(){u.value.roleId!=null&&(u.value.deptIds=De(),yl(u.value).then(n=>{r.$modal.msgSuccess("修改成功"),R.value=!1,w()}))}function Fe(){R.value=!1,A()}return w(),(n,e)=>{const p=s("el-input"),d=s("el-form-item"),Q=s("el-option"),ee=s("el-select"),le=s("el-date-picker"),v=s("el-button"),te=s("el-form"),H=s("el-col"),Oe=s("right-toolbar"),je=s("el-row"),K=s("el-table-column"),Be=s("el-switch"),P=s("el-tooltip"),Ye=s("el-table"),Qe=s("pagination"),He=s("question-filled"),Je=s("el-icon"),Ge=s("el-input-number"),We=s("el-radio"),Xe=s("el-radio-group"),T=s("el-checkbox"),ce=s("el-tree"),fe=s("el-dialog"),x=ke("hasPermi"),Ze=ke("loading");return f(),J("div",bl,[g(t(te,{model:a(y),ref:"queryRef",inline:!0,"label-width":"68px"},{default:o(()=>[t(d,{label:"角色名称",prop:"roleName"},{default:o(()=>[t(p,{modelValue:a(y).roleName,"onUpdate:modelValue":e[0]||(e[0]=l=>a(y).roleName=l),placeholder:"请输入角色名称",clearable:"",style:{width:"240px"},onKeyup:be(Y,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(d,{label:"权限字符",prop:"roleKey"},{default:o(()=>[t(p,{modelValue:a(y).roleKey,"onUpdate:modelValue":e[1]||(e[1]=l=>a(y).roleKey=l),placeholder:"请输入权限字符",clearable:"",style:{width:"240px"},onKeyup:be(Y,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(d,{label:"状态",prop:"status"},{default:o(()=>[t(ee,{modelValue:a(y).status,"onUpdate:modelValue":e[2]||(e[2]=l=>a(y).status=l),placeholder:"角色状态",clearable:"",style:{width:"240px"}},{default:o(()=>[(f(!0),J(oe,null,ne(a(L),l=>(f(),k(Q,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"创建时间",style:{width:"308px"}},{default:o(()=>[t(le,{modelValue:a(I),"onUpdate:modelValue":e[3]||(e[3]=l=>N(I)?I.value=l:null),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),t(d,null,{default:o(()=>[t(v,{type:"primary",icon:"Search",onClick:Y},{default:o(()=>[m("搜索")]),_:1}),t(v,{icon:"Refresh",onClick:xe},{default:o(()=>[m("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[ae,a(V)]]),t(je,{gutter:10,class:"mb8"},{default:o(()=>[t(H,{span:1.5},{default:o(()=>[g((f(),k(v,{type:"primary",plain:"",icon:"Plus",onClick:$e},{default:o(()=>[m("新增")]),_:1})),[[x,["system:role:add"]]])]),_:1}),t(H,{span:1.5},{default:o(()=>[g((f(),k(v,{type:"success",plain:"",icon:"Edit",disabled:a(U),onClick:re},{default:o(()=>[m("修改")]),_:1},8,["disabled"])),[[x,["system:role:edit"]]])]),_:1}),t(H,{span:1.5},{default:o(()=>[g((f(),k(v,{type:"danger",plain:"",icon:"Delete",disabled:a(ue),onClick:de},{default:o(()=>[m("删除")]),_:1},8,["disabled"])),[[x,["system:role:remove"]]])]),_:1}),t(H,{span:1.5},{default:o(()=>[g((f(),k(v,{type:"warning",plain:"",icon:"Download",onClick:Ne},{default:o(()=>[m("导出")]),_:1})),[[x,["system:role:export"]]])]),_:1}),t(Oe,{showSearch:a(V),"onUpdate:showSearch":e[4]||(e[4]=l=>N(V)?V.value=l:null),onQueryTable:w},null,8,["showSearch"])]),_:1}),g((f(),k(Ye,{data:a($),onSelectionChange:Ue},{default:o(()=>[t(K,{type:"selection",width:"55",align:"center"}),t(K,{label:"角色编号",prop:"roleId",width:"120"}),t(K,{label:"角色名称",prop:"roleName","show-overflow-tooltip":!0,width:"150"}),t(K,{label:"权限字符",prop:"roleKey","show-overflow-tooltip":!0,width:"150"}),t(K,{label:"显示顺序",prop:"roleSort",width:"100"}),t(K,{label:"状态",align:"center",width:"100"},{default:o(l=>[t(Be,{modelValue:l.row.status,"onUpdate:modelValue":D=>l.row.status=D,"active-value":"0","inactive-value":"1",onChange:D=>Ie(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(K,{label:"创建时间",align:"center",prop:"createTime"},{default:o(l=>[G("span",null,Ve(n.parseTime(l.row.createTime)),1)]),_:1}),t(K,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:o(l=>[l.row.roleId!==1?(f(),k(P,{key:0,content:"修改",placement:"top"},{default:o(()=>[g(t(v,{link:"",type:"primary",icon:"Edit",onClick:D=>re(l.row)},null,8,["onClick"]),[[x,["system:role:edit"]]])]),_:2},1024)):W("",!0),l.row.roleId!==1?(f(),k(P,{key:1,content:"删除",placement:"top"},{default:o(()=>[g(t(v,{link:"",type:"primary",icon:"Delete",onClick:D=>de(l.row)},null,8,["onClick"]),[[x,["system:role:remove"]]])]),_:2},1024)):W("",!0),l.row.roleId!==1?(f(),k(P,{key:2,content:"数据权限",placement:"top"},{default:o(()=>[g(t(v,{link:"",type:"primary",icon:"CircleCheck",onClick:D=>Le(l.row)},null,8,["onClick"]),[[x,["system:role:edit"]]])]),_:2},1024)):W("",!0),l.row.roleId!==1?(f(),k(P,{key:3,content:"分配用户",placement:"top"},{default:o(()=>[g(t(v,{link:"",type:"primary",icon:"User",onClick:D=>Re(l.row)},null,8,["onClick"]),[[x,["system:role:edit"]]])]),_:2},1024)):W("",!0)]),_:1})]),_:1},8,["data"])),[[Ze,a(E)]]),g(t(Qe,{total:a(Z),page:a(y).pageNum,"onUpdate:page":e[5]||(e[5]=l=>a(y).pageNum=l),limit:a(y).pageSize,"onUpdate:limit":e[6]||(e[6]=l=>a(y).pageSize=l),onPagination:w},null,8,["total","page","limit"]),[[ae,a(Z)>0]]),t(fe,{title:a(M),modelValue:a(b),"onUpdate:modelValue":e[18]||(e[18]=l=>N(b)?b.value=l:null),width:"500px","append-to-body":""},{footer:o(()=>[G("div",Vl,[t(v,{type:"primary",onClick:qe},{default:o(()=>[m("确 定")]),_:1}),t(v,{onClick:Ae},{default:o(()=>[m("取 消")]),_:1})])]),default:o(()=>[t(te,{ref:"roleRef",model:a(u),rules:a(Ke),"label-width":"100px"},{default:o(()=>[t(d,{label:"角色名称",prop:"roleName"},{default:o(()=>[t(p,{modelValue:a(u).roleName,"onUpdate:modelValue":e[7]||(e[7]=l=>a(u).roleName=l),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(d,{prop:"roleKey"},{label:o(()=>[G("span",null,[t(P,{content:"控制器中定义的权限字符，如：@PreAuthorize(`@ss.hasRole('admin')`)",placement:"top"},{default:o(()=>[t(Je,null,{default:o(()=>[t(He)]),_:1})]),_:1}),m(" 权限字符 ")])]),default:o(()=>[t(p,{modelValue:a(u).roleKey,"onUpdate:modelValue":e[8]||(e[8]=l=>a(u).roleKey=l),placeholder:"请输入权限字符"},null,8,["modelValue"])]),_:1}),t(d,{label:"角色顺序",prop:"roleSort"},{default:o(()=>[t(Ge,{modelValue:a(u).roleSort,"onUpdate:modelValue":e[9]||(e[9]=l=>a(u).roleSort=l),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1}),t(d,{label:"状态"},{default:o(()=>[t(Xe,{modelValue:a(u).status,"onUpdate:modelValue":e[10]||(e[10]=l=>a(u).status=l)},{default:o(()=>[(f(!0),J(oe,null,ne(a(L),l=>(f(),k(We,{key:l.value,label:l.value},{default:o(()=>[m(Ve(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"菜单权限"},{default:o(()=>[t(T,{modelValue:a(z),"onUpdate:modelValue":e[11]||(e[11]=l=>N(z)?z.value=l:null),onChange:e[12]||(e[12]=l=>se(l,"menu"))},{default:o(()=>[m("展开/折叠")]),_:1},8,["modelValue"]),t(T,{modelValue:a(F),"onUpdate:modelValue":e[13]||(e[13]=l=>N(F)?F.value=l:null),onChange:e[14]||(e[14]=l=>ie(l,"menu"))},{default:o(()=>[m("全选/全不选")]),_:1},8,["modelValue"]),t(T,{modelValue:a(u).menuCheckStrictly,"onUpdate:modelValue":e[15]||(e[15]=l=>a(u).menuCheckStrictly=l),onChange:e[16]||(e[16]=l=>pe(l,"menu"))},{default:o(()=>[m("父子联动")]),_:1},8,["modelValue"]),t(ce,{class:"tree-border",data:a(q),"show-checkbox":"",ref_key:"menuRef",ref:C,"node-key":"id","check-strictly":!a(u).menuCheckStrictly,"empty-text":"加载中，请稍候",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])]),_:1}),t(d,{label:"备注"},{default:o(()=>[t(p,{modelValue:a(u).remark,"onUpdate:modelValue":e[17]||(e[17]=l=>a(u).remark=l),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),t(fe,{title:a(M),modelValue:a(R),"onUpdate:modelValue":e[28]||(e[28]=l=>N(R)?R.value=l:null),width:"500px","append-to-body":""},{footer:o(()=>[G("div",Cl,[t(v,{type:"primary",onClick:ze},{default:o(()=>[m("确 定")]),_:1}),t(v,{onClick:Fe},{default:o(()=>[m("取 消")]),_:1})])]),default:o(()=>[t(te,{model:a(u),"label-width":"80px"},{default:o(()=>[t(d,{label:"角色名称"},{default:o(()=>[t(p,{modelValue:a(u).roleName,"onUpdate:modelValue":e[19]||(e[19]=l=>a(u).roleName=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(d,{label:"权限字符"},{default:o(()=>[t(p,{modelValue:a(u).roleKey,"onUpdate:modelValue":e[20]||(e[20]=l=>a(u).roleKey=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(d,{label:"权限范围"},{default:o(()=>[t(ee,{modelValue:a(u).dataScope,"onUpdate:modelValue":e[21]||(e[21]=l=>a(u).dataScope=l),onChange:Pe},{default:o(()=>[(f(!0),J(oe,null,ne(a(Se),l=>(f(),k(Q,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),g(t(d,{label:"数据权限"},{default:o(()=>[t(T,{modelValue:a(O),"onUpdate:modelValue":e[22]||(e[22]=l=>N(O)?O.value=l:null),onChange:e[23]||(e[23]=l=>se(l,"dept"))},{default:o(()=>[m("展开/折叠")]),_:1},8,["modelValue"]),t(T,{modelValue:a(j),"onUpdate:modelValue":e[24]||(e[24]=l=>N(j)?j.value=l:null),onChange:e[25]||(e[25]=l=>ie(l,"dept"))},{default:o(()=>[m("全选/全不选")]),_:1},8,["modelValue"]),t(T,{modelValue:a(u).deptCheckStrictly,"onUpdate:modelValue":e[26]||(e[26]=l=>a(u).deptCheckStrictly=l),onChange:e[27]||(e[27]=l=>pe(l,"dept"))},{default:o(()=>[m("父子联动")]),_:1},8,["modelValue"]),t(ce,{class:"tree-border",data:a(B),"show-checkbox":"","default-expand-all":"",ref_key:"deptRef",ref:S,"node-key":"id","check-strictly":!a(u).deptCheckStrictly,"empty-text":"加载中，请稍候",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])]),_:1},512),[[ae,a(u).dataScope==2]])]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});export{Il as default};
