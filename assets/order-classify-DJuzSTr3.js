var pe=Object.defineProperty;var j=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var F=(d,u,o)=>u in d?pe(d,u,{enumerable:!0,configurable:!0,writable:!0,value:o}):d[u]=o,N=(d,u)=>{for(var o in u||(u={}))de.call(u,o)&&F(d,o,u[o]);if(j)for(var o of j(u))me.call(u,o)&&F(d,o,u[o]);return d};var p=(d,u,o)=>new Promise((i,I)=>{var S=c=>{try{g(o.next(c))}catch(h){I(h)}},y=c=>{try{g(o.throw(c))}catch(h){I(h)}},g=c=>c.done?i(c.value):Promise.resolve(c.value).then(S,y);g((o=o.apply(d,u)).next())});import{_ as fe,r,J as ge,x as ve,d as m,M as ye,c as _e,o as _,s as C,l as V,e as A,f as l,N as H,h as s,k,O as he,E as z,D as f}from"./index-CUeo8D_D.js";import we from"./index-DXbfwroF.js";import be from"./index-Bqk-FQmz.js";import Ce from"./index-ZxZv3TUJ.js";import{g as ke,b as Ie,c as Se,e as K,f as De}from"./index-B-Hi2gU1.js";import{g as xe}from"./user-DqcAyiJo.js";import"./index-D7f4lOdi.js";const Ne={class:"app-container"},Ve={class:"list-container"},Be={class:"dialog-footer"},Pe={__name:"order-classify",setup(d){const u=r([{type:"select",prop:"parentId",label:"所属店铺",placeholder:"请选择所属店铺"}]),o=r([{type:"input",prop:"name",label:"分类名称",width:12,formItemProps:{placeholder:"请输入分类名称"},rule:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},{type:"select",prop:"parentId",label:"所属店铺",width:12,formItemProps:{placeholder:"请选择所属店铺",multiple:!0},options:[],rule:[{required:!0,message:"请选择所属店铺",trigger:"change"}]},{type:"input",prop:"orderNum",label:"排序",width:12,formItemProps:{placeholder:"请输入排序"},rule:[{required:!0,message:"请输入排序",trigger:"blur"}]}]),i=ge({tableData:[],total:0,formData:{}}),I=r([]),S=r(!0),y=r({pageNum:1,pageSize:10}),g=r({}),c=r(!1),h=r(!0),D=r({}),x=r(""),w=r(!1),q=r(null),E=r(!1),J=r(""),O=r("0"),Q=r([]),B=r([]),R=()=>p(this,null,function*(){let t=yield xe();D.value=t.data}),v=()=>p(this,null,function*(){c.value=!0;try{let t=yield Ie(N(N({},y.value),g.value));i.tableData=t.rows.map(e=>(e.parentIdName=oe(e.parentId),e)),i.total=t.total,c.value=!1}catch(t){c.value=!1}}),G=t=>p(this,null,function*(){c.value=!0,g.value=t,D.value.roles.every(e=>e.roleKey!="admin"&&e.roleKey!="sysadmin")&&!t.parentId&&(g.value.parentId=String(B.value.map(e=>e.storeId).join(","))),v()}),W=t=>{I.value=t.map(e=>e.id),h.value=!t.length},X=()=>{x.value="新增分类",w.value=!0},Y=t=>{x.value="修改分类",w.value=!0,i.formData=N({},t),i.formData.parentId=t.parentId.split(",").map(e=>e)},L=t=>{z.confirm("是否确认删除该分类？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>p(this,null,function*(){let e=t.id||I.value;yield Se({id:e}).then(()=>{v(),f({type:"success",message:"删除成功"})}).catch(()=>{})})).catch(()=>{f({type:"info",message:"取消删除"})})},Z=t=>{z.confirm("是否启用该分类？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>p(this,null,function*(){let e=t.id;yield K({id:e,status:"1"}),v(),f({type:"success",message:"更改成功"})})).catch(()=>{f({type:"info",message:"取消更改"})})},ee=t=>{z.confirm("是否停用该分类？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>p(this,null,function*(){let e=t.id;yield K({id:e,status:"0"}),v(),f({type:"success",message:"更改成功"})})).catch(()=>{f({type:"info",message:"取消更改"})})},te=()=>p(this,null,function*(){q.value.submitRef().then(t=>p(this,null,function*(){t&&(w.value=!1,i.formData.parentId=i.formData.parentId.join(","),x.value=="新增分类"?(yield De(i.formData),f.success("新增成功")):x.value=="修改分类"&&(yield K(i.formData),f.success("修改成功")),v())}))}),ae=()=>{w.value=!1,f.info("取消")},le=()=>{i.formData={}},ne=()=>p(this,null,function*(){let t={};D.value.roles.every(a=>a.roleKey!="admin"&&a.roleKey!="sysadmin")&&(t.phone=D.value.phonenumber);let e=yield ke(N({pageNum:1,pageSize:20},t));B.value=e.rows,u.value[0].options=e.rows.map(a=>({label:a.name,value:String(a.storeId)})),o.value.find(a=>a.prop=="parentId").options=e.rows.map(a=>({label:a.name,value:String(a.storeId)})),D.value.roles.every(a=>a.roleKey!="admin"&&a.roleKey!="sysadmin")&&(g.value.parentId=String(B.value.map(a=>a.storeId).join(",")))}),oe=t=>t.split(",").map(P=>B.value.find(U=>U.storeId==P).name).join(",");return ve(()=>p(this,null,function*(){yield R(),yield ne(),yield v()})),(t,e)=>{const a=m("el-button"),P=m("el-col"),U=m("right-toolbar"),se=m("el-row"),b=m("el-table-column"),$=m("el-tag"),T=m("el-tooltip"),re=m("el-table"),ie=m("pagination"),ue=m("el-dialog"),ce=ye("loading");return _(),_e("div",Ne,[S.value?(_(),C(we,{key:0,settings:u.value,onHandleSearch:G},null,8,["settings"])):V("",!0),A("div",Ve,[l(se,{gutter:10,class:"mb8"},{default:s(()=>[l(P,{span:1.5},{default:s(()=>[l(a,{type:"primary",plain:"",icon:"Plus",onClick:X},{default:s(()=>[k("新增")]),_:1})]),_:1}),l(P,{span:1.5},{default:s(()=>[l(a,{type:"danger",plain:"",icon:"Delete",disabled:h.value,onClick:L},{default:s(()=>[k("删除")]),_:1},8,["disabled"])]),_:1}),l(U,{showSearch:S.value,"onUpdate:showSearch":e[0]||(e[0]=n=>S.value=n),onQueryTable:v},null,8,["showSearch"])]),_:1}),H((_(),C(re,{data:i.tableData,onSelectionChange:W},{default:s(()=>[l(b,{type:"selection",width:"50",align:"center"}),l(b,{label:"名称",align:"center",prop:"name"}),l(b,{label:"所属店铺",align:"center",prop:"parentIdName"}),l(b,{label:"顺序",align:"center",prop:"orderNum"}),l(b,{label:"状态",align:"center",prop:"status"},{default:s(n=>[n.row.status=="1"?(_(),C($,{key:0},{default:s(()=>[k("正常")]),_:1})):V("",!0),n.row.status=="0"?(_(),C($,{key:1,type:"danger"},{default:s(()=>[k("停用")]),_:1})):V("",!0)]),_:1}),l(b,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:s(n=>[l(T,{content:"修改",placement:"top"},{default:s(()=>[l(a,{link:"",type:"primary",icon:"Edit",onClick:M=>Y(n.row)},null,8,["onClick"])]),_:2},1024),l(T,{content:"删除",placement:"top"},{default:s(()=>[l(a,{link:"",type:"primary",icon:"Delete",onClick:M=>L(n.row)},null,8,["onClick"])]),_:2},1024),n.row.status=="0"?(_(),C(T,{key:0,content:"启用",placement:"top"},{default:s(()=>[l(a,{link:"",type:"primary",icon:"CircleCheck",onClick:M=>Z(n.row)},null,8,["onClick"])]),_:2},1024)):V("",!0),n.row.status=="1"?(_(),C(T,{key:1,content:"停用",placement:"top"},{default:s(()=>[l(a,{link:"",type:"primary",icon:"CircleClose",onClick:M=>ee(n.row)},null,8,["onClick"])]),_:2},1024)):V("",!0)]),_:1})]),_:1},8,["data"])),[[ce,c.value]]),H(l(ie,{total:i.total,page:y.value.pageNum,"onUpdate:page":e[1]||(e[1]=n=>y.value.pageNum=n),limit:y.value.pageSize,"onUpdate:limit":e[2]||(e[2]=n=>y.value.pageSize=n),onPagination:v},null,8,["total","page","limit"]),[[he,i.total>0]])]),l(ue,{title:x.value,modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=n=>w.value=n),width:"40%",onClosed:le,draggable:"","destroy-on-close":!0},{footer:s(()=>[A("div",Be,[l(a,{type:"primary",onClick:te},{default:s(()=>[k("确 定")]),_:1}),l(a,{onClick:ae},{default:s(()=>[k("取 消")]),_:1})])]),default:s(()=>[l(be,{settings:o.value,modelValue:i.formData,"onUpdate:modelValue":e[3]||(e[3]=n=>i.formData=n),ref_key:"base_form",ref:q},null,8,["settings","modelValue"])]),_:1},8,["title","modelValue"]),l(Ce,{modelValue:E.value,"onUpdate:modelValue":e[5]||(e[5]=n=>E.value=n),size:"auto","img-list":Q.value,title:J.value,"init-number":O.value},null,8,["modelValue","img-list","title","init-number"])])}}},$e=fe(Pe,[["__scopeId","data-v-f5c21196"]]);export{$e as default};
