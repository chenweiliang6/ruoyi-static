var Te=Object.defineProperty;var te=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var ae=(_,u,i)=>u in _?Te(_,u,{enumerable:!0,configurable:!0,writable:!0,value:i}):_[u]=i,P=(_,u)=>{for(var i in u||(u={}))$e.call(u,i)&&ae(_,i,u[i]);if(te)for(var i of te(u))ze.call(u,i)&&ae(_,i,u[i]);return _};var d=(_,u,i)=>new Promise((r,S)=>{var U=p=>{try{k(i.next(p))}catch(I){S(I)}},b=p=>{try{k(i.throw(p))}catch(I){S(I)}},k=p=>p.done?r(p.value):Promise.resolve(p.value).then(U,b);k((i=i.apply(_,u)).next())});import{_ as Ee,r as s,J as Le,x as qe,d as c,M as Ke,c as N,o as m,s as C,l as L,e as D,f as a,N as le,h as o,k as f,A,O as Me,F as je,z as Fe,E as R,D as g}from"./index-CUeo8D_D.js";import Ae from"./index-DXbfwroF.js";import Re from"./index-Bqk-FQmz.js";import Ge from"./index-ZxZv3TUJ.js";import{g as He,b as Je,h as Oe,i as Qe,j as G,k as We}from"./index-B-Hi2gU1.js";import{g as Xe}from"./user-DqcAyiJo.js";import{d as Ye}from"./export-DRQPRSom.js";import"./index-D7f4lOdi.js";const Ze={class:"app-container"},et={class:"list-container"},tt=["src","onClick"],at={key:1},lt={key:1},ot={class:"add-guige"},nt={class:"add-guige-table__title"},st={style:{"font-size":"16px","font-weight":"bold","padding-right":"5px"}},rt={class:"dialog-footer"},it={class:"dialog-footer"},ut={__name:"product-list",setup(_){const u=s([{type:"select",prop:"parentId",label:"所属分类",placeholder:"请选择所属分类"},{type:"input",prop:"name",label:"商品名称",placeholder:"请输入商品名称"}]),i=s([{type:"input",prop:"name",label:"商品名称",width:12,formItemProps:{placeholder:"请输入商品名称"},rule:[{required:!0,message:"请输入商品名称",trigger:"blur"}]},{type:"select",prop:"parentId",label:"所属分类",width:12,formItemProps:{placeholder:"请选择所属分类"},rule:[{required:!0,message:"请选择所属分类",trigger:"change"}]},{type:"input",prop:"desc",label:"商品描述",width:12,formItemProps:{placeholder:"请输入商品描述"},rule:[{required:!0,message:"请输入商品描述",trigger:"blur"}]},{type:"input",prop:"orderNum",label:"显示顺序",width:12,formItemProps:{placeholder:"请输入显示顺序"},rule:[{required:!0,message:"请输入显示顺序",trigger:"blur"}]},{type:"upload",uploadType:"img",listType:"picture-card",limit:1,prop:"imgs",label:"商品图",width:12,formItemProps:{placeholder:"请上传商品图"}}]),r=Le({tableData:[],total:0,formData:{}}),S=s([]),U=s(!0),b=s({pageNum:1,pageSize:10}),k=s({}),p=s(!1),I=s(!0),B=s({}),T=s(""),V=s(!1),H=s(null),M=s(!1),J=s(""),oe=s("0"),O=s([]),j=s(null),$=s(!1),q=s({}),y=s([{title:"分量",list:[{name:"",price:""}]}]),Q=s({}),W=s([]),ne=()=>d(this,null,function*(){let t=yield Xe();B.value=t.data}),h=()=>d(this,null,function*(){p.value=!0;try{let t=yield Oe(P(P({},b.value),k.value));r.tableData=t.rows.map(e=>(e.parentIdName=W.value.find(n=>n.id==e.parentId).name,e)),r.total=t.total,p.value=!1}catch(t){p.value=!1}}),se=t=>d(this,null,function*(){p.value=!0,k.value=t,h()}),re=t=>{S.value=t.map(e=>e.storeId),I.value=!t.length},ie=()=>{T.value="新增商品",y.value=[{title:"分量",list:[{name:"",price:""}]}],V.value=!0},ue=t=>{T.value="修改商品",V.value=!0,r.formData=P({},t),r.formData.imgs=r.formData.img?[{url:r.formData.img}]:[],y.value=t.specs},ce=()=>d(this,null,function*(){let t={};S.value.forEach((n,z)=>{t[z]=n});let e=yield exportAccount(t);Ye(e,"商品.xlsx")}),X=t=>{R.confirm("是否确认删除该商品？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>d(this,null,function*(){console.log(t,"row"),t.storeId||S.value,yield Qe({}),h(),g({type:"success",message:"删除成功"})})).catch(()=>{g({type:"info",message:"取消删除"})})},de=t=>{R.confirm("是否启用该商品？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>d(this,null,function*(){let e=t.storeId;yield G({storeId:e,status:"1"}),h(),g({type:"success",message:"更改成功"})})).catch(()=>{g({type:"info",message:"取消更改"})})},pe=t=>{R.confirm("是否停用该商品？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>d(this,null,function*(){let e=t.storeId;yield G({storeId:e,status:"0"}),h(),g({type:"success",message:"更改成功"})})).catch(()=>{g({type:"info",message:"取消更改"})})},me=()=>{let t=!0;for(let e=0;e<y.value.length;e++)if(y.value[e].list.length){if(y.value[e].list.some(n=>!n.name)){g.error("请填写完整的规格！"),t=!1;break}}else{g.error("请填写完整的规格！"),t=!1;break}return t},fe=()=>d(this,null,function*(){H.value.submitRef().then(t=>d(this,null,function*(){var e;if(t){if(!me())return;V.value=!1,r.formData.img=(e=r.formData.imgs)!=null&&e.length?r.formData.imgs[0].url:"",r.formData.specs=y.value,T.value=="新增商品"?(yield We(r.formData),g.success("新增成功")):T.value=="修改商品"&&(yield G(r.formData),g.success("修改成功")),h()}}))}),ge=()=>{V.value=!1,g.info("取消")},ve=(t,e)=>{if(t.title=="分量"&&e==0){g.error("不能删除分量，请填写");return}y.value.splice(e,1)},_e=()=>d(this,null,function*(){j.value&&(yield j.value.validate((t,e)=>{t&&(y.value.push({title:q.value.title,list:[{name:"",price:""}]}),$.value=!1)}))}),ye=()=>{$.value=!1},we=t=>{t.list.push({name:"",price:""})},he=(t,e)=>{e.list.splice(t,1)},be=()=>{r.formData={}},ke=(t,e)=>{O.value=[{url:t}],J.value=e,M.value=!0},Ce=()=>d(this,null,function*(){let t={};B.value.roles.every(n=>n.roleKey!="admin"&&n.roleKey!="sysadmin")&&(t.phone=B.value.phonenumber);let e=yield He(P({pageNum:1,pageSize:20},t));B.value.roles.every(n=>n.roleKey!="admin"&&n.roleKey!="sysadmin")&&(Q.value.parentId=String(e.rows.map(n=>n.storeId).join(",")))}),De=()=>d(this,null,function*(){let t=yield Je(P({pageNum:1,pageSize:30},Q.value));W.value=t.rows,u.value.find(e=>e.prop=="parentId").options=i.value.find(e=>e.prop=="parentId").options=t.rows.map(e=>({label:e.name,value:String(e.id)})),B.value.roles.every(e=>e.roleKey!="admin"&&e.roleKey!="sysadmin")&&(k.value.parentId=String(t.rows.map(e=>e.id).join(",")))});return qe(()=>d(this,null,function*(){yield ne(),yield Ce(),yield De(),yield h()})),(t,e)=>{const n=c("el-button"),z=c("el-col"),Se=c("right-toolbar"),Ie=c("el-row"),v=c("el-table-column"),E=c("el-tooltip"),Y=c("el-tag"),Z=c("el-table"),Ve=c("pagination"),xe=c("Delete"),Pe=c("el-icon"),F=c("el-input"),ee=c("el-dialog"),Ne=c("el-form-item"),Ue=c("el-form"),Be=Ke("loading");return m(),N("div",Ze,[U.value?(m(),C(Ae,{key:0,settings:u.value,onHandleSearch:se},null,8,["settings"])):L("",!0),D("div",et,[a(Ie,{gutter:10,class:"mb8"},{default:o(()=>[a(z,{span:1.5},{default:o(()=>[a(n,{type:"primary",plain:"",icon:"Plus",onClick:ie},{default:o(()=>[f("新增")]),_:1})]),_:1}),a(z,{span:1.5},{default:o(()=>[a(n,{type:"danger",plain:"",icon:"Delete",disabled:I.value,onClick:X},{default:o(()=>[f("删除")]),_:1},8,["disabled"])]),_:1}),a(z,{span:1.5},{default:o(()=>[a(n,{type:"warning",plain:"",icon:"Download",onClick:ce},{default:o(()=>[f("导出")]),_:1})]),_:1}),a(Se,{showSearch:U.value,"onUpdate:showSearch":e[0]||(e[0]=l=>U.value=l),onQueryTable:h},null,8,["showSearch"])]),_:1}),le((m(),C(Z,{data:r.tableData},{default:o(()=>[a(v,{type:"selection",width:"50",align:"center"}),a(v,{label:"商品名称",align:"center",prop:"name"}),a(v,{label:"所属分类",align:"center",prop:"parentIdName"}),a(v,{label:"商品图",align:"center",prop:"img"},{default:o(l=>[l.row.img?(m(),N("img",{key:0,src:l.row.img,style:{width:"60px",height:"60px",cursor:"pointer","object-fit":"cover"},onClick:x=>ke(l.row.img,"商品图")},null,8,tt)):(m(),N("span",at,"暂无"))]),_:1}),a(v,{label:"商品描述",align:"center",prop:"desc"},{default:o(l=>[l.row.desc.length>15?(m(),C(E,{key:0,class:"box-item",effect:"dark",content:l.row.desc,placement:"top"},{default:o(()=>[D("span",null,A(l.row.desc.slice(0,15)+"..."),1)]),_:2},1032,["content"])):(m(),N("span",lt,A(l.row.desc),1))]),_:1}),a(v,{label:"顺序",align:"center",prop:"orderNum"}),a(v,{label:"状态",align:"center",prop:"status"},{default:o(l=>[l.row.status=="1"?(m(),C(Y,{key:0},{default:o(()=>[f("正常")]),_:1})):L("",!0),l.row.status=="0"?(m(),C(Y,{key:1,type:"danger"},{default:o(()=>[f("停用")]),_:1})):L("",!0)]),_:1}),a(v,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:o(l=>[a(E,{content:"修改",placement:"top"},{default:o(()=>[a(n,{link:"",type:"primary",icon:"Edit",onClick:x=>ue(l.row)},null,8,["onClick"])]),_:2},1024),a(E,{content:"删除",placement:"top"},{default:o(()=>[a(n,{link:"",type:"primary",icon:"Delete",onClick:x=>X(l.row)},null,8,["onClick"])]),_:2},1024),l.row.status=="0"?(m(),C(E,{key:0,content:"启用",placement:"top"},{default:o(()=>[a(n,{link:"",type:"primary",icon:"CircleCheck",onClick:x=>de(l.row)},null,8,["onClick"])]),_:2},1024)):L("",!0),l.row.status=="1"?(m(),C(E,{key:1,content:"停用",placement:"top"},{default:o(()=>[a(n,{link:"",type:"primary",icon:"CircleClose",onClick:x=>pe(l.row)},null,8,["onClick"])]),_:2},1024)):L("",!0)]),_:1})]),_:1},8,["data"])),[[Be,p.value]]),le(a(Ve,{total:r.total,page:b.value.pageNum,"onUpdate:page":e[1]||(e[1]=l=>b.value.pageNum=l),limit:b.value.pageSize,"onUpdate:limit":e[2]||(e[2]=l=>b.value.pageSize=l),onPagination:h},null,8,["total","page","limit"]),[[Me,r.total>0]])]),a(ee,{title:T.value,modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=l=>V.value=l),width:"40%",onClosed:be,draggable:"","destroy-on-close":!0,"close-on-click-modal":!1},{footer:o(()=>[D("div",rt,[a(n,{type:"primary",onClick:fe},{default:o(()=>[f("确 定")]),_:1}),a(n,{onClick:ge},{default:o(()=>[f("取 消")]),_:1})])]),default:o(()=>[a(Re,{settings:i.value,modelValue:r.formData,"onUpdate:modelValue":e[3]||(e[3]=l=>r.formData=l),ref_key:"base_form",ref:H},null,8,["settings","modelValue"]),D("div",ot,[(m(!0),N(je,null,Fe(y.value,(l,x)=>(m(),N("div",{class:"add-guige-table",key:l.title},[D("div",nt,[D("span",st,A(l.title),1),a(Pe,{color:"red",size:"20",style:{cursor:"pointer"},onClick:w=>ve(l,x)},{default:o(()=>[a(xe)]),_:2},1032,["onClick"])]),a(Z,{data:l.list,onSelectionChange:re,style:{width:"100% !important"}},{default:o(()=>[a(v,{label:"名称",align:"center",prop:"name"},{default:o(w=>[a(F,{modelValue:w.row.name,"onUpdate:modelValue":K=>w.row.name=K,placeholder:"请输入名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(v,{label:"价格(元)",align:"center",prop:"price"},{default:o(w=>[a(F,{modelValue:w.row.price,"onUpdate:modelValue":K=>w.row.price=K,placeholder:"不输入默认为0"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(v,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:o(w=>[a(n,{type:"danger",link:"",onClick:K=>he(w.$index,l)},{default:o(()=>[f("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["data"]),a(n,{type:"primary",plain:"",style:{width:"100%","margin-top":"15px"},onClick:w=>we(l)},{default:o(()=>[f("添加")]),_:2},1032,["onClick"])]))),128)),a(n,{type:"primary",plain:"",onClick:e[4]||(e[4]=l=>$.value=!0),style:{"margin-top":"20px"}},{default:o(()=>[f("添加规格")]),_:1})])]),_:1},8,["title","modelValue"]),a(ee,{title:"添加规格",modelValue:$.value,"onUpdate:modelValue":e[7]||(e[7]=l=>$.value=l),width:"20%"},{footer:o(()=>[D("div",it,[a(n,{type:"primary",onClick:_e},{default:o(()=>[f("确 定")]),_:1}),a(n,{onClick:ye},{default:o(()=>[f("取 消")]),_:1})])]),default:o(()=>[a(Ue,{model:q.value,"label-width":"auto",rules:{title:[{required:!0,message:"请输入规格标题",trigger:"blur"}]},ref_key:"specs_form",ref:j},{default:o(()=>[a(Ne,{label:"规格标题",prop:"title"},{default:o(()=>[a(F,{modelValue:q.value.title,"onUpdate:modelValue":e[6]||(e[6]=l=>q.value.title=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(Ge,{modelValue:M.value,"onUpdate:modelValue":e[8]||(e[8]=l=>M.value=l),size:"auto","img-list":O.value,title:J.value,"init-number":oe.value},null,8,["modelValue","img-list","title","init-number"])])}}},wt=Ee(ut,[["__scopeId","data-v-f0371b7f"]]);export{wt as default};
