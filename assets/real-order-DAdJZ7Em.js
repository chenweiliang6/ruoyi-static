var ie=Object.defineProperty;var L=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var E=(t,o,n)=>o in t?ie(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n,z=(t,o)=>{for(var n in o||(o={}))de.call(o,n)&&E(t,n,o[n]);if(L)for(var n of L(o))ue.call(o,n)&&E(t,n,o[n]);return t};var y=(t,o,n)=>new Promise((m,D)=>{var I=u=>{try{w(n.next(u))}catch(h){D(h)}},_=u=>{try{w(n.throw(u))}catch(h){D(h)}},w=u=>u.done?m(u.value):Promise.resolve(u.value).then(I,_);w((n=n.apply(t,o)).next())});import{y as R,_ as ce,r as c,J as pe,x as me,d as b,M as _e,c as x,o as p,f as s,s as k,l as g,e as r,h as d,N as H,A as f,F as ve,z as ge,k as N,O as he,p as ye,q as be,E as fe,D as T}from"./index-CIuGMKj0.js";import we from"./index-D7_yHGAD.js";import ke from"./index-DetL7Jqd.js";import Se from"./index-BpWe7GXi.js";import{g as Ie}from"./index-Cd3HeMeG.js";import{g as Ve}from"./user-syCh5Mp-.js";import"./index-DISU4tlk.js";function Ne(t){let o={pageNum:t.pageNum,pageSize:t.pageSize};return R({url:"/order/list",method:"post",data:t,params:o})}function Ce(t){return R({url:"/order/updateStatus",method:"put",data:t})}function xe(t){let o={pageNum:t.pageNum,pageSize:t.pageSize};return R({url:"/rider/user/list",method:"post",data:t,params:o})}function De(t){return R({url:"/order/dispatch",method:"post",data:t})}const Pe=t=>(ye("data-v-42093aba"),t=t(),be(),t),Be={class:"app-container"},ze={class:"list-container"},Re={class:"expanded-container"},Ue={key:0,class:"expanded-container-address"},We={class:"address-name"},Te={class:"address-phone"},Ke={class:"address-detail"};const $e={key:2,class:"expanded-container-remark"},Le=Pe(()=>r("div",{class:"remark-title"},"备注",-1)),Ee={class:"remark-value"},He={class:"expanded-container-product"},Oe={class:"product-title"},Fe={class:"product-item-img"},Me=["src"],je={class:"product-item-content"},Ae={class:"product-item-content__name"},Je={class:"product-item-content__guige"},qe={class:"product-item-content__price"},Ge={class:"price-one"},Qe={class:"price-number"},Xe={class:"product-item-content__total"},Ye={class:"dialog-footer"},Ze={__name:"real-order",setup(t){const o=c([{type:"input",prop:"phone",label:"手机号",placeholder:"请输入手机号"},{type:"select",prop:"status",label:"订单状态",placeholder:"请选择订单状态",options:[{label:"制作中",value:"0"},{label:"待配送",value:"1"},{label:"配送中",value:"2"},{label:"已完成",value:"3"}]},{type:"date",dateType:"daterange",prop:"timeRange",label:"日期",startPlaceholder:"开始日期",endPlaceholder:"结束日期"}]),n=c([{type:"select",prop:"userId",label:"外卖员",width:24,formItemProps:{placeholder:"请选择外卖员"},rule:[{required:!0,message:"请选择外卖员",trigger:"change"}]}]),m=pe({tableData:[],total:0,formData:{}}),D=c(!0),I=c({pageNum:1,pageSize:10}),_=c({pickWay:"自取"}),w=c(!1),u=c({}),h=c(!1),K=c(null),$=c(!1),O=c(""),F=c("0"),M=c([]),U=c({}),P=c([]),j=()=>y(this,null,function*(){let l=yield Ve();u.value=l.data}),A=l=>{_.value.pickWay=l,V()},V=()=>y(this,null,function*(){w.value=!0;try{u.value.roles.every(a=>a.roleKey!="admin"&&a.roleKey!="sysadmin")?(o.value=[{type:"input",prop:"phone",label:"手机号",placeholder:"请输入手机号"},{type:"select",prop:"status",label:"订单状态",placeholder:"请选择订单状态",options:[{label:"制作中",value:"0"},{label:"待配送",value:"1"},{label:"配送中",value:"2"},{label:"已完成",value:"3"}]},{type:"date",dateType:"daterange",prop:"timeRange",label:"日期",startPlaceholder:"开始日期",endPlaceholder:"结束日期"}],_.value.userId=u.value.userId):o.value=[{type:"input",prop:"phone",label:"手机号",placeholder:"请输入手机号"},{type:"select",prop:"storeId",label:"店铺",placeholder:"请选择店铺",options:P.value.map(a=>({label:a.name,value:a.storeId}))},{type:"select",prop:"status",label:"订单状态",placeholder:"请选择订单状态",options:[{label:"制作中",value:"0"},{label:"待配送",value:"1"},{label:"配送中",value:"2"},{label:"已完成",value:"3"}]},{type:"date",dateType:"daterange",prop:"timeRange",label:"日期",startPlaceholder:"开始日期",endPlaceholder:"结束日期"}];let l=yield Ne(z(z({},I.value),_.value));m.tableData=l.rows.map(a=>a),m.total=l.total,w.value=!1}catch(l){w.value=!1}}),J=l=>y(this,null,function*(){w.value=!0;let a=_.value.pickWay;_.value=l,_.value.pickWay=a,u.value.roles.every(i=>i.roleKey!="admin"&&i.roleKey!="sysadmin")&&!l.parentId&&(_.value.parentId=String(P.value.map(i=>i.storeId).join(","))),V()}),q=l=>{h.value=!0,U.value=l},G=l=>{h.value=!0,U.value=l},Q=l=>{fe.confirm("是否确认完成该订单？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>y(this,null,function*(){yield Ce({id:l.id,status:"3"}),T.success("确认完成"),V()}))},X=()=>y(this,null,function*(){K.value.submitRef().then(l=>y(this,null,function*(){l&&(h.value=!1,yield De({id:U.value.id,riderId:m.formData.userId}),T.success("派单成功"),V())}))}),Y=()=>{h.value=!1,T.info("取消")},Z=()=>{m.formData={}},ee=()=>y(this,null,function*(){let l={};u.value.roles.every(i=>i.roleKey!="admin"&&i.roleKey!="sysadmin")&&(l.phone=u.value.phonenumber);let a=yield Ie(z({pageNum:1,pageSize:20},l));P.value=a.rows,o.value[0].options=a.rows.map(i=>({label:i.name,value:String(i.storeId)})),u.value.roles.every(i=>i.roleKey!="admin"&&i.roleKey!="sysadmin")&&(_.value.parentId=String(P.value.map(i=>i.storeId).join(",")))}),ae=()=>y(this,null,function*(){let l=yield xe({pageNum:1,pageSize:100});n.value[0].options=l.rows.map(a=>({label:a.nickName+"("+a.phonenumber+")",value:a.userId,disabled:a.riderStatus!="1"}))});return me(()=>y(this,null,function*(){ae(),yield j(),yield ee(),yield V()})),(l,a)=>{const i=b("el-tab-pane"),te=b("el-tabs"),S=b("el-table-column"),B=b("el-tag"),C=b("el-button"),W=b("el-tooltip"),le=b("el-table"),oe=b("pagination"),se=b("el-time-picker"),re=b("el-dialog"),ne=_e("loading");return p(),x("div",Be,[s(te,{modelValue:_.value.pickWay,"onUpdate:modelValue":a[0]||(a[0]=e=>_.value.pickWay=e),class:"demo-tabs",onTabChange:A},{default:d(()=>[s(i,{label:"自取",name:"自取"}),s(i,{label:"外卖",name:"外卖"})]),_:1},8,["modelValue"]),D.value?(p(),k(we,{key:0,settings:o.value,onHandleSearch:J},null,8,["settings"])):g("",!0),r("div",ze,[H((p(),k(le,{data:m.tableData,"default-expand-all":""},{default:d(()=>[s(S,{type:"expand",width:"35",align:"center"},{default:d(e=>[r("div",Re,[e.row.address?(p(),x("div",Ue,[r("div",We,f(`${e.row.address.name}(${e.row.address.gender=="1"?"先生":"女士"})`),1),r("div",Te,"顾客电话："+f(e.row.address.phone),1),r("div",Ke,"顾客地址："+f(`${e.row.address.address}(${e.row.address.houseNumber})`),1)])):g("",!0),g("",!0),e.row.remark?(p(),x("div",$e,[Le,r("div",Ee,f(e.row.remark),1)])):g("",!0),r("div",He,[r("div",Oe,"共"+f(e.row.shopCart.length)+"件商品",1),(p(!0),x(ve,null,ge(e.row.shopCart,v=>(p(),x("div",{class:"product-item",key:v.id},[r("div",Fe,[r("img",{src:v.img},null,8,Me)]),r("div",je,[r("div",Ae,f(v.name),1),r("div",Je,"规格："+f(v.remarks),1),r("div",qe,[r("div",Ge,"单价："+f(v.price)+"元",1),r("div",Qe,"数量：×"+f(v.number),1)]),r("div",Xe," 总价："+f(v.price*v.number)+"元 ",1)])]))),128))])])]),_:1}),s(S,{label:"店铺名称",align:"center",prop:"storeName"}),s(S,{label:"取餐方式",align:"center",prop:"pickWay"}),s(S,{label:"桌号",align:"center",prop:"tableNumber"}),s(S,{label:"预留电话",align:"center",prop:"phone"}),s(S,{label:"创建时间",align:"center",prop:"createTime"}),s(S,{label:"状态",align:"center",prop:"status"},{default:d(e=>[e.row.status=="0"?(p(),k(B,{key:0,type:"warning"},{default:d(()=>[N("制作中")]),_:1})):g("",!0),e.row.status=="1"?(p(),k(B,{key:1},{default:d(()=>[N("待配送")]),_:1})):g("",!0),e.row.status=="2"?(p(),k(B,{key:2,type:"info"},{default:d(()=>[N("配送中")]),_:1})):g("",!0),e.row.status=="3"?(p(),k(B,{key:3,type:"success"},{default:d(()=>[N("已完成")]),_:1})):g("",!0)]),_:1}),s(S,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:d(e=>[e.row.status=="1"||e.row.status=="2"?(p(),k(W,{key:0,content:"修改骑手",placement:"top"},{default:d(()=>[s(C,{link:"",type:"primary",icon:"Edit",onClick:v=>G(e.row)},null,8,["onClick"])]),_:2},1024)):g("",!0),e.row.status=="0"&&e.row.pickWay=="店内就餐"?(p(),k(W,{key:1,content:"完成",placement:"top"},{default:d(()=>[s(C,{link:"",type:"primary",icon:"CircleCheck",onClick:v=>Q(e.row)},null,8,["onClick"])]),_:2},1024)):g("",!0),e.row.status=="0"&&e.row.pickWay=="外卖"?(p(),k(W,{key:2,content:"派单",placement:"top"},{default:d(()=>[s(C,{link:"",type:"primary",icon:"Promotion",onClick:v=>q(e.row)},null,8,["onClick"])]),_:2},1024)):g("",!0)]),_:1})]),_:1},8,["data"])),[[ne,w.value]]),H(s(oe,{total:m.total,page:I.value.pageNum,"onUpdate:page":a[1]||(a[1]=e=>I.value.pageNum=e),limit:I.value.pageSize,"onUpdate:limit":a[2]||(a[2]=e=>I.value.pageSize=e),onPagination:V},null,8,["total","page","limit"]),[[he,m.total>0]])]),s(re,{title:"外卖派单",modelValue:h.value,"onUpdate:modelValue":a[5]||(a[5]=e=>h.value=e),width:"20%",onClosed:Z,draggable:"","destroy-on-close":!0},{footer:d(()=>[r("div",Ye,[s(C,{type:"primary",onClick:X},{default:d(()=>[N("确 定")]),_:1}),s(C,{onClick:Y},{default:d(()=>[N("取 消")]),_:1})])]),default:d(()=>[s(ke,{settings:n.value,modelValue:m.formData,"onUpdate:modelValue":a[4]||(a[4]=e=>m.formData=e),ref_key:"base_form",ref:K},{timeRange:d(()=>[s(se,{modelValue:m.formData.timeRange,"onUpdate:modelValue":a[3]||(a[3]=e=>m.formData.timeRange=e),"is-range":"","range-separator":"至",startPlaceholder:"开始时间",endPlaceholder:"结束时间",rangeSeparator:"至","value-format":"HH:mm",format:"HH:mm"},null,8,["modelValue"])]),_:1},8,["settings","modelValue"])]),_:1},8,["modelValue"]),s(Se,{modelValue:$.value,"onUpdate:modelValue":a[6]||(a[6]=e=>$.value=e),size:"auto","img-list":M.value,title:O.value,"init-number":F.value},null,8,["modelValue","img-list","title","init-number"])])}}},ia=ce(Ze,[["__scopeId","data-v-42093aba"]]);export{ia as default};
