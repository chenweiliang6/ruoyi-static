var ze=Object.defineProperty;var ae=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable;var te=(w,s,m)=>s in w?ze(w,s,{enumerable:!0,configurable:!0,writable:!0,value:m}):w[s]=m,O=(w,s)=>{for(var m in s||(s={}))Me.call(s,m)&&te(w,m,s[m]);if(ae)for(var m of ae(s))Oe.call(s,m)&&te(w,m,s[m]);return w};var D=(w,s,m)=>new Promise((E,P)=>{var V=h=>{try{S(m.next(h))}catch(C){P(C)}},T=h=>{try{S(m.throw(h))}catch(C){P(C)}},S=h=>h.done?E(h.value):Promise.resolve(h.value).then(V,T);S((m=m.apply(w,s)).next())});import{I as Ee,a as je,g as Ae,r as p,J as oe,a9 as Qe,P as He,x as Je,d as i,M as Ge,c as R,o as d,N as G,f as l,O as ne,h as t,j as ue,i as o,F,z as L,s as f,k as g,l as k,e as U,A as se}from"./index-BxoItr7S.js";import{g as We,e as Xe,f as Ye,h as Ze,r as el}from"./user-BXa85Bq3.js";import{g as ll,l as al,m as tl,n as ol}from"./index-DjPZ_0EG.js";import{e as re}from"./jsencrypt-B91xViJm.js";const nl={class:"app-container"},ul={class:"dialog-footer"},sl=U("div",{class:"el-upload__text"},[g("将文件拖到此处，或"),U("em",null,"点击上传")],-1),rl={class:"el-upload__tip text-center"},dl={class:"el-upload__tip"},il=U("span",null,"仅允许导入xls、xlsx格式文件。",-1),pl={class:"dialog-footer"},ml=Ee({name:"User"}),bl=Object.assign(ml,{setup(w){je();const{proxy:s}=Ae(),{sys_normal_disable:m,sys_user_sex:E}=s.useDict("sys_normal_disable","sys_user_sex"),P=p([]),V=p(!1),T=p(!0),S=p(!0),h=p([]),C=p(!0),W=p(!0),j=p(0),A=p(""),de=p([]);p(""),p(void 0);const ie=p(void 0),pe=p([]),me=p([]),_=oe({open:!1,title:"",isUploading:!1,updateSupport:0,headers:{Authorization:"Bearer "+Qe()},url:"/ruoyi/system/user/importData"}),Q=p({}),B=p([]),N=p([{key:0,label:"用户编号",visible:!0},{key:1,label:"用户名称",visible:!0},{key:2,label:"用户昵称",visible:!0},{key:3,label:"部门",visible:!0},{key:4,label:"手机号码",visible:!0},{key:5,label:"状态",visible:!0},{key:6,label:"创建时间",visible:!0}]),ce=oe({form:{roleIds:[102]},queryParams:{pageNum:1,pageSize:10,userName:void 0,status:void 0},rules:{userName:[{required:!0,message:"用户名称不能为空",trigger:"blur"},{min:2,max:20,message:"用户名称长度必须介于 2 和 20 之间",trigger:"blur"}],nickName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],password:[{required:!0,message:"用户密码不能为空",trigger:"blur"},{min:5,max:20,message:"用户密码长度必须介于 5 和 20 之间",trigger:"blur"},{pattern:/^[^<>"'|\\]+$/,message:`不能包含非法字符：< > " ' \\ |`,trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],phonenumber:[{required:!0,message:"手机号码不能为空",trigger:"blur"},{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}],storeId:[{required:!0,message:"请选择店铺",trigger:"change"}]}}),{queryParams:c,form:n,rules:fe}=He(ce),X=p({}),I=()=>D(this,null,function*(){T.value=!0,console.log(c.value,"requestParam.value"),yield al(O(O({},X.value),c.value)).then(u=>{T.value=!1,P.value=u.rows.map(a=>{var r;return a.storeIdName=(r=B.value.find(v=>v.phone==a.phonenumber))==null?void 0:r.name,a}),j.value=u.total})});function K(){c.value.pageNum=1,I()}function ve(){de.value=[],s.resetForm("queryRef"),delete c.value.phonenumber,c.value.deptId=void 0,K()}function Y(u){const a=u.userId||h.value;s.$modal.confirm('是否确认删除用户编号为"'+a+'"的数据项？').then(function(){return Ye(a)}).then(()=>{I(),s.$modal.msgSuccess("删除成功")}).catch(()=>{})}function _e(u){let a=u.status==="0"?"启用":"停用";s.$modal.confirm('确认要"'+a+'""'+u.userName+'"用户吗?').then(function(){return Ze(u.userId,u.status)}).then(()=>{s.$modal.msgSuccess(a+"成功")}).catch(function(){u.status=u.status==="0"?"1":"0"})}function ge(u){s.$prompt('请输入"'+u.userName+'"的新密码',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputPattern:/^.{5,20}$/,inputErrorMessage:"用户密码长度必须介于 5 和 20 之间",inputValidator:a=>{if(/<|>|"|'|\||\\/.test(a))return`不能包含非法字符：< > " ' \\ |`}}).then(({value:a})=>{el(u.userId,re(a)).then(r=>{s.$modal.msgSuccess("修改成功，新密码是："+a)})}).catch(()=>{})}function be(u){h.value=u.map(a=>a.userId),C.value=u.length!=1,W.value=!u.length}function ye(){s.download("system/user/importTemplate",{},`user_template_${new Date().getTime()}.xlsx`)}const he=(u,a,r)=>{_.isUploading=!0},ke=(u,a,r)=>{_.open=!1,_.isUploading=!1,s.$refs.uploadRef.handleRemove(a),s.$alert("<div style='overflow: auto;overflow-x: hidden;max-height: 70vh;padding: 10px 20px 0;'>"+u.msg+"</div>","导入结果",{dangerouslyUseHTMLString:!0}),I()};function we(){s.$refs.uploadRef.submit()}function H(){n.value={userId:void 0,deptId:void 0,userName:void 0,nickName:void 0,password:void 0,phonenumber:void 0,email:void 0,sex:void 0,status:"0",remark:void 0,postIds:[],roleIds:[102]},s.resetForm("userRef")}function Ve(){V.value=!1,H()}function xe(){H(),V.value=!0,A.value="添加用户",n.value.password=ie.value}function Z(u){H();const a=u.userId||h.value;Xe(a).then(r=>{n.value=r.data,pe.value=r.posts,me.value=r.roles,n.value.postIds=r.postIds,n.value.roleIds=r.roleIds,V.value=!0,A.value="修改用户",n.password=""})}function Ie(){s.$refs.userRef.validate(u=>{u&&(n.value.userId!=null?tl(n.value).then(a=>{s.$modal.msgSuccess("修改成功"),V.value=!1,I()}):(n.value.password=re(n.value.password),ol(n.value).then(a=>{s.$modal.msgSuccess("新增成功"),V.value=!1,I()})))})}const Ue=()=>D(this,null,function*(){let u=yield We();Q.value=u.data}),Se=()=>D(this,null,function*(){let u={};Q.value.roles.every(r=>r.roleKey!="admin"&&r.roleKey!="sysadmin")&&(u.userId=Q.value.userId);let a=yield ll(O({pageNum:1,pageSize:20},u));B.value=a.rows,X.value.phonenumber=[...new Set(a.rows.map(r=>r.phone))].join(",")});return Je(()=>D(this,null,function*(){yield Ue(),yield Se(),yield I()})),(u,a)=>{const r=i("el-input"),v=i("el-form-item"),z=i("el-option"),M=i("el-select"),b=i("el-button"),ee=i("el-form"),y=i("el-col"),Ne=i("right-toolbar"),$=i("el-row"),x=i("el-table-column"),Ce=i("el-switch"),J=i("el-tooltip"),$e=i("el-table"),Re=i("pagination"),Pe=i("el-radio"),Te=i("el-radio-group"),le=i("el-dialog"),qe=i("upload-filled"),De=i("el-icon"),Fe=i("el-checkbox"),Le=i("el-link"),Be=i("el-upload"),Ke=Ge("loading");return d(),R("div",nl,[G(l(ee,{model:o(c),ref:"queryRef",inline:!0,"label-width":"68px"},{default:t(()=>[l(v,{label:"用户名称",prop:"userName"},{default:t(()=>[l(r,{modelValue:o(c).userName,"onUpdate:modelValue":a[0]||(a[0]=e=>o(c).userName=e),placeholder:"请输入用户名称",clearable:"",style:{width:"240px"},onKeyup:ue(K,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),l(v,{label:"手机号码",prop:"phonenumber"},{default:t(()=>[l(r,{modelValue:o(c).phonenumber,"onUpdate:modelValue":a[1]||(a[1]=e=>o(c).phonenumber=e),placeholder:"请输入手机号码",clearable:"",style:{width:"240px"},onKeyup:ue(K,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),l(v,{label:"店铺",prop:"status"},{default:t(()=>[l(M,{modelValue:o(c).phonenumber,"onUpdate:modelValue":a[2]||(a[2]=e=>o(c).phonenumber=e),placeholder:"请选择店铺",clearable:"",style:{width:"240px"}},{default:t(()=>[(d(!0),R(F,null,L(B.value,e=>(d(),f(z,{key:e.phone,label:e.name,value:e.phone},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"状态",prop:"status"},{default:t(()=>[l(M,{modelValue:o(c).status,"onUpdate:modelValue":a[3]||(a[3]=e=>o(c).status=e),placeholder:"用户状态",clearable:"",style:{width:"240px"}},{default:t(()=>[(d(!0),R(F,null,L(o(m),e=>(d(),f(z,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(v,null,{default:t(()=>[l(b,{type:"primary",icon:"Search",onClick:K},{default:t(()=>[g("搜索")]),_:1}),l(b,{icon:"Refresh",onClick:ve},{default:t(()=>[g("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[ne,S.value]]),l($,{gutter:10,class:"mb8"},{default:t(()=>[l(y,{span:1.5},{default:t(()=>[l(b,{type:"primary",plain:"",icon:"Plus",onClick:xe},{default:t(()=>[g("新增")]),_:1})]),_:1}),l(y,{span:1.5},{default:t(()=>[l(b,{type:"success",plain:"",icon:"Edit",disabled:C.value,onClick:Z},{default:t(()=>[g("修改")]),_:1},8,["disabled"])]),_:1}),l(y,{span:1.5},{default:t(()=>[l(b,{type:"danger",plain:"",icon:"Delete",disabled:W.value,onClick:Y},{default:t(()=>[g("删除")]),_:1},8,["disabled"])]),_:1}),l(Ne,{showSearch:S.value,"onUpdate:showSearch":a[4]||(a[4]=e=>S.value=e),onQueryTable:I,columns:N.value},null,8,["showSearch","columns"])]),_:1}),G((d(),f($e,{data:P.value,onSelectionChange:be},{default:t(()=>[l(x,{type:"selection",width:"50",align:"center"}),N.value[0].visible?(d(),f(x,{label:"用户编号",align:"center",key:"userId",prop:"userId"})):k("",!0),N.value[1].visible?(d(),f(x,{label:"用户名称",align:"center",key:"userName",prop:"userName","show-overflow-tooltip":!0})):k("",!0),N.value[2].visible?(d(),f(x,{label:"用户昵称",align:"center",key:"nickName",prop:"nickName","show-overflow-tooltip":!0})):k("",!0),l(x,{label:"绑定店铺",align:"center",key:"storeIdName",prop:"storeIdName"}),N.value[4].visible?(d(),f(x,{label:"手机号码",align:"center",key:"phonenumber",prop:"phonenumber",width:"120"})):k("",!0),N.value[5].visible?(d(),f(x,{label:"状态",align:"center",key:"status"},{default:t(e=>[l(Ce,{modelValue:e.row.status,"onUpdate:modelValue":q=>e.row.status=q,"active-value":"0","inactive-value":"1",onChange:q=>_e(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):k("",!0),N.value[6].visible?(d(),f(x,{key:5,label:"创建时间",align:"center",prop:"createTime",width:"160"},{default:t(e=>[U("span",null,se(u.parseTime(e.row.createTime)),1)]),_:1})):k("",!0),l(x,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:t(e=>[e.row.userId!==1?(d(),f(J,{key:0,content:"修改",placement:"top"},{default:t(()=>[l(b,{link:"",type:"primary",icon:"Edit",onClick:q=>Z(e.row)},null,8,["onClick"])]),_:2},1024)):k("",!0),e.row.userId!==1?(d(),f(J,{key:1,content:"删除",placement:"top"},{default:t(()=>[l(b,{link:"",type:"primary",icon:"Delete",onClick:q=>Y(e.row)},null,8,["onClick"])]),_:2},1024)):k("",!0),e.row.userId!==1?(d(),f(J,{key:2,content:"重置密码",placement:"top"},{default:t(()=>[l(b,{link:"",type:"primary",icon:"Key",onClick:q=>ge(e.row)},null,8,["onClick"])]),_:2},1024)):k("",!0)]),_:1})]),_:1},8,["data"])),[[Ke,T.value]]),G(l(Re,{total:j.value,page:o(c).pageNum,"onUpdate:page":a[5]||(a[5]=e=>o(c).pageNum=e),limit:o(c).pageSize,"onUpdate:limit":a[6]||(a[6]=e=>o(c).pageSize=e),onPagination:I},null,8,["total","page","limit"]),[[ne,j.value>0]]),l(le,{title:A.value,modelValue:V.value,"onUpdate:modelValue":a[16]||(a[16]=e=>V.value=e),width:"600px","append-to-body":""},{footer:t(()=>[U("div",ul,[l(b,{type:"primary",onClick:Ie},{default:t(()=>[g("确 定")]),_:1}),l(b,{onClick:Ve},{default:t(()=>[g("取 消")]),_:1})])]),default:t(()=>[l(ee,{model:o(n),rules:o(fe),ref:"userRef","label-width":"80px"},{default:t(()=>[l($,null,{default:t(()=>[l(y,{span:12},{default:t(()=>[l(v,{label:"用户昵称",prop:"nickName"},{default:t(()=>[l(r,{modelValue:o(n).nickName,"onUpdate:modelValue":a[7]||(a[7]=e=>o(n).nickName=e),placeholder:"请输入用户昵称",maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:12},{default:t(()=>[l(v,{label:"手机号码",prop:"phonenumber"},{default:t(()=>[l(r,{modelValue:o(n).phonenumber,"onUpdate:modelValue":a[8]||(a[8]=e=>o(n).phonenumber=e),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l($,null,{default:t(()=>[l(y,{span:12},{default:t(()=>[o(n).userId==null?(d(),f(v,{key:0,label:"用户名称",prop:"userName"},{default:t(()=>[l(r,{modelValue:o(n).userName,"onUpdate:modelValue":a[9]||(a[9]=e=>o(n).userName=e),placeholder:"请输入用户名称",maxlength:"30"},null,8,["modelValue"])]),_:1})):k("",!0)]),_:1}),l(y,{span:12},{default:t(()=>[o(n).userId==null?(d(),f(v,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(r,{modelValue:o(n).password,"onUpdate:modelValue":a[10]||(a[10]=e=>o(n).password=e),placeholder:"请输入用户密码",type:"password",maxlength:"20","show-password":""},null,8,["modelValue"])]),_:1})):k("",!0)]),_:1})]),_:1}),l($,null,{default:t(()=>[l(y,{span:12},{default:t(()=>[l(v,{label:"邮箱",prop:"email"},{default:t(()=>[l(r,{modelValue:o(n).email,"onUpdate:modelValue":a[11]||(a[11]=e=>o(n).email=e),placeholder:"请输入邮箱",maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:12},{default:t(()=>[l(v,{label:"店铺",prop:"storeId"},{default:t(()=>[l(M,{modelValue:o(n).storeId,"onUpdate:modelValue":a[12]||(a[12]=e=>o(n).storeId=e),placeholder:"请选择"},{default:t(()=>[(d(!0),R(F,null,L(B.value,e=>(d(),f(z,{key:e.storeId,label:e.name,value:String(e.storeId)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l($,null,{default:t(()=>[l(y,{span:12},{default:t(()=>[l(v,{label:"用户性别"},{default:t(()=>[l(M,{modelValue:o(n).sex,"onUpdate:modelValue":a[13]||(a[13]=e=>o(n).sex=e),placeholder:"请选择"},{default:t(()=>[(d(!0),R(F,null,L(o(E),e=>(d(),f(z,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(y,{span:12},{default:t(()=>[l(v,{label:"状态"},{default:t(()=>[l(Te,{modelValue:o(n).status,"onUpdate:modelValue":a[14]||(a[14]=e=>o(n).status=e)},{default:t(()=>[(d(!0),R(F,null,L(o(m),e=>(d(),f(Pe,{key:e.value,label:e.value},{default:t(()=>[g(se(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l($,null,{default:t(()=>[l(y,{span:24},{default:t(()=>[l(v,{label:"备注"},{default:t(()=>[l(r,{modelValue:o(n).remark,"onUpdate:modelValue":a[15]||(a[15]=e=>o(n).remark=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),l(le,{title:_.title,modelValue:_.open,"onUpdate:modelValue":a[19]||(a[19]=e=>_.open=e),width:"400px","append-to-body":""},{footer:t(()=>[U("div",pl,[l(b,{type:"primary",onClick:we},{default:t(()=>[g("确 定")]),_:1}),l(b,{onClick:a[18]||(a[18]=e=>_.open=!1)},{default:t(()=>[g("取 消")]),_:1})])]),default:t(()=>[l(Be,{ref:"uploadRef",limit:1,accept:".xlsx, .xls",headers:_.headers,action:_.url+"?updateSupport="+_.updateSupport,disabled:_.isUploading,"on-progress":he,"on-success":ke,"auto-upload":!1,drag:""},{tip:t(()=>[U("div",rl,[U("div",dl,[l(Fe,{modelValue:_.updateSupport,"onUpdate:modelValue":a[17]||(a[17]=e=>_.updateSupport=e)},null,8,["modelValue"]),g("是否更新已经存在的用户数据 ")]),il,l(Le,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:ye},{default:t(()=>[g("下载模板")]),_:1})])]),default:t(()=>[l(De,{class:"el-icon--upload"},{default:t(()=>[l(qe)]),_:1}),sl]),_:1},8,["headers","action","disabled"])]),_:1},8,["title","modelValue"])])}}});export{bl as default};
