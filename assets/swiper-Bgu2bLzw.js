var me=Object.defineProperty;var H=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var J=(d,u,s)=>u in d?me(d,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):d[u]=s,P=(d,u)=>{for(var s in u||(u={}))de.call(u,s)&&J(d,s,u[s]);if(H)for(var s of H(u))ge.call(u,s)&&J(d,s,u[s]);return d};var c=(d,u,s)=>new Promise((o,S)=>{var b=p=>{try{v(s.next(p))}catch(I){S(I)}},w=p=>{try{v(s.throw(p))}catch(I){S(I)}},v=p=>p.done?o(p.value):Promise.resolve(p.value).then(b,w);v((s=s.apply(d,u)).next())});import{_ as fe,r as i,J as ve,x as ye,d as f,M as he,c as N,o as m,s as D,l as V,e as O,f as r,N as Q,h as n,k as C,O as _e,E as K,D as y}from"./index-BxoItr7S.js";import we from"./index-B_oFCXxs.js";import be from"./index-CmaQYcJb.js";import Ie from"./index-B6tTlV03.js";import{g as ke,o as De,p as Ce,q as z,r as Se}from"./index-DjPZ_0EG.js";import{g as xe}from"./user-BXa85Bq3.js";import"./index-CmtOAOSu.js";const Te={class:"app-container"},Pe={class:"list-container"},Ne=["src","onClick"],Ve={key:1},Be=["src","onClick"],qe={key:1},Ue={class:"dialog-footer"},$e={__name:"swiper",setup(d){const u=i([{type:"select",prop:"storeId",label:"所属店铺",placeholder:"请选择所属店铺"}]),s=i([{type:"input",prop:"name",label:"名称",width:12,formItemProps:{placeholder:"请输入名称"},rule:[{required:!0,message:"请输入名称",trigger:"blur"}]},{type:"select",prop:"storeId",label:"所属店铺",width:12,formItemProps:{placeholder:"请选择所属店铺"},options:[],rule:[{required:!0,message:"请选择所属店铺",trigger:"change"}]},{type:"upload",uploadType:"img",listType:"picture-card",limit:1,prop:"imgs",label:"上层图片",width:12,formItemProps:{placeholder:"请上传上层图片"},rule:[{required:!0,message:"请上传上层图片",trigger:"change"}]},{type:"upload",uploadType:"img",listType:"picture-card",limit:1,prop:"backImgs",label:"下层图片",width:12,formItemProps:{placeholder:"请上传下层图片"}},{type:"input",prop:"orderNum",label:"排序",width:12,formItemProps:{placeholder:"请输入排序"},rule:[{required:!0,message:"请输入排序",trigger:"blur"}]}]),o=ve({tableData:[],total:0,formData:{}}),S=i([]),b=i(!0),w=i({pageNum:1,pageSize:10}),v=i({}),p=i(!1),I=i(!0),g=i({}),x=i(""),k=i(!1),E=i(null),$=i(!1),L=i(""),R=i("0"),M=i([]),B=i([]),G=()=>c(this,null,function*(){let a=yield xe();g.value=a.data,a.data.storeId&&(b.value=!1,s.value=[{type:"input",prop:"name",label:"名称",width:12,formItemProps:{placeholder:"请输入名称"},rule:[{required:!0,message:"请输入名称",trigger:"blur"}]},{type:"input",prop:"orderNum",label:"排序",width:12,formItemProps:{placeholder:"请输入排序"},rule:[{required:!0,message:"请输入排序",trigger:"blur"}]},{type:"upload",uploadType:"img",listType:"picture-card",limit:1,prop:"imgs",label:"上层图片",width:12,formItemProps:{placeholder:"请上传上层图片"},rule:[{required:!0,message:"请上传上层图片",trigger:"change"}]},{type:"upload",uploadType:"img",listType:"picture-card",limit:1,prop:"backImgs",label:"下层图片",width:12,formItemProps:{placeholder:"请上传下层图片"}}],o.formData.storeId=g.value.storeId)}),h=()=>c(this,null,function*(){p.value=!0;try{g.value.storeId&&(v.value.storeId=g.value.storeId);let a=yield De(P(P({},w.value),v.value));o.tableData=a.rows.map(e=>{var t;return e.storeIdName=(t=B.value.find(q=>q.storeId==e.storeId))==null?void 0:t.name,e}),o.total=a.total,p.value=!1}catch(a){p.value=!1}}),W=a=>c(this,null,function*(){p.value=!0,v.value=a,g.value.roles.every(e=>e.roleKey!="admin"&&e.roleKey!="sysadmin")&&!a.storeId&&(v.value.storeId=String(B.value.map(e=>e.storeId).join(","))),h()}),X=a=>{S.value=a.map(e=>e.storeId),I.value=!a.length},Y=()=>{x.value="新增轮播图",k.value=!0},Z=a=>{x.value="修改轮播图",k.value=!0,o.formData=P({},a),o.formData.imgs=o.formData.img?[{url:o.formData.img}]:[],o.formData.backImgs=o.formData.backImg?[{url:o.formData.backImg}]:[]},j=a=>{K.confirm("是否确认删除该轮播图？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>c(this,null,function*(){let e=a.id||S.value;yield Ce({id:e}),h(),y({type:"success",message:"删除成功"})})).catch(()=>{y({type:"info",message:"取消删除"})})},ee=a=>{K.confirm("是否启用该轮播图？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>c(this,null,function*(){let e=a.id;yield z({id:e,status:"1"}),h(),y({type:"success",message:"更改成功"})})).catch(()=>{y({type:"info",message:"取消更改"})})},te=a=>{K.confirm("是否停用该轮播图？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>c(this,null,function*(){let e=a.id;yield z({id:e,status:"0"}),h(),y({type:"success",message:"更改成功"})})).catch(()=>{y({type:"info",message:"取消更改"})})},F=(a,e)=>{M.value=[{url:a}],L.value=e,$.value=!0},ae=()=>c(this,null,function*(){E.value.submitRef().then(a=>c(this,null,function*(){var e,t;a&&(k.value=!1,o.formData.img=(e=o.formData.imgs)!=null&&e.length?o.formData.imgs[0].url:"",o.formData.backImg=(t=o.formData.backImgs)!=null&&t.length?o.formData.backImgs[0].url:"",x.value=="新增轮播图"?(yield Se(o.formData),y.success("新增成功")):x.value=="修改轮播图"&&(yield z(o.formData),y.success("修改成功")),h())}))}),le=()=>{k.value=!1,y.info("取消")},oe=()=>{o.formData={}},re=()=>c(this,null,function*(){let a={};g.value.roles.every(t=>t.roleKey!="admin"&&t.roleKey!="sysadmin")&&(g.value.storeId?a.storeId=g.value.storeId:a.phone=g.value.phonenumber);let e=yield ke(P({pageNum:1,pageSize:20},a));B.value=e.rows,u.value[0].options=e.rows.map(t=>({label:t.name,value:String(t.storeId)})),s.value.find(t=>t.prop=="storeId")&&(s.value.find(t=>t.prop=="storeId").options=e.rows.map(t=>({label:t.name,value:String(t.storeId)}))),g.value.roles.every(t=>t.roleKey!="admin"&&t.roleKey!="sysadmin")&&(v.value.storeId=String(B.value.map(t=>t.storeId).join(",")))});return ye(()=>c(this,null,function*(){yield G(),yield re(),yield h()})),(a,e)=>{const t=f("el-button"),q=f("el-col"),se=f("right-toolbar"),ne=f("el-row"),_=f("el-table-column"),A=f("el-tag"),U=f("el-tooltip"),ie=f("el-table"),ue=f("pagination"),pe=f("el-dialog"),ce=he("loading");return m(),N("div",Te,[b.value?(m(),D(we,{key:0,settings:u.value,onHandleSearch:W},null,8,["settings"])):V("",!0),O("div",Pe,[r(ne,{gutter:10,class:"mb8"},{default:n(()=>[r(q,{span:1.5},{default:n(()=>[r(t,{type:"primary",plain:"",icon:"Plus",onClick:Y},{default:n(()=>[C("新增")]),_:1})]),_:1}),r(q,{span:1.5},{default:n(()=>[r(t,{type:"danger",plain:"",icon:"Delete",disabled:I.value,onClick:j},{default:n(()=>[C("删除")]),_:1},8,["disabled"])]),_:1}),r(se,{showSearch:b.value,"onUpdate:showSearch":e[0]||(e[0]=l=>b.value=l),onQueryTable:h},null,8,["showSearch"])]),_:1}),Q((m(),D(ie,{data:o.tableData,onSelectionChange:X},{default:n(()=>[r(_,{type:"selection",width:"50",align:"center"}),r(_,{label:"名称",align:"center",prop:"name"}),r(_,{label:"所属店铺",align:"center",prop:"storeIdName"}),r(_,{label:"上层图片",align:"center",prop:"img"},{default:n(l=>[l.row.img?(m(),N("img",{key:0,src:l.row.img,style:{width:"60px",height:"60px",cursor:"pointer"},onClick:T=>F(l.row.img,"上层图片")},null,8,Ne)):(m(),N("span",Ve,"暂无"))]),_:1}),r(_,{label:"下层图片",align:"center",prop:"backImg"},{default:n(l=>[l.row.backImg?(m(),N("img",{key:0,src:l.row.backImg,style:{width:"60px",height:"60px",cursor:"pointer"},onClick:T=>F(l.row.backImg,"下层图片")},null,8,Be)):(m(),N("span",qe,"暂无"))]),_:1}),r(_,{label:"顺序",align:"center",prop:"orderNum"}),r(_,{label:"状态",align:"center",prop:"status"},{default:n(l=>[l.row.status=="1"?(m(),D(A,{key:0},{default:n(()=>[C("正常")]),_:1})):V("",!0),l.row.status=="0"?(m(),D(A,{key:1,type:"danger"},{default:n(()=>[C("停用")]),_:1})):V("",!0)]),_:1}),r(_,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:n(l=>[r(U,{content:"修改",placement:"top"},{default:n(()=>[r(t,{link:"",type:"primary",icon:"Edit",onClick:T=>Z(l.row)},null,8,["onClick"])]),_:2},1024),r(U,{content:"删除",placement:"top"},{default:n(()=>[r(t,{link:"",type:"primary",icon:"Delete",onClick:T=>j(l.row)},null,8,["onClick"])]),_:2},1024),l.row.status=="0"?(m(),D(U,{key:0,content:"启用",placement:"top"},{default:n(()=>[r(t,{link:"",type:"primary",icon:"CircleCheck",onClick:T=>ee(l.row)},null,8,["onClick"])]),_:2},1024)):V("",!0),l.row.status=="1"?(m(),D(U,{key:1,content:"停用",placement:"top"},{default:n(()=>[r(t,{link:"",type:"primary",icon:"CircleClose",onClick:T=>te(l.row)},null,8,["onClick"])]),_:2},1024)):V("",!0)]),_:1})]),_:1},8,["data"])),[[ce,p.value]]),Q(r(ue,{total:o.total,page:w.value.pageNum,"onUpdate:page":e[1]||(e[1]=l=>w.value.pageNum=l),limit:w.value.pageSize,"onUpdate:limit":e[2]||(e[2]=l=>w.value.pageSize=l),onPagination:h},null,8,["total","page","limit"]),[[_e,o.total>0]])]),r(pe,{title:x.value,modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=l=>k.value=l),width:"40%",onClosed:oe,draggable:"","destroy-on-close":!0},{footer:n(()=>[O("div",Ue,[r(t,{type:"primary",onClick:ae},{default:n(()=>[C("确 定")]),_:1}),r(t,{onClick:le},{default:n(()=>[C("取 消")]),_:1})])]),default:n(()=>[r(be,{settings:s.value,modelValue:o.formData,"onUpdate:modelValue":e[3]||(e[3]=l=>o.formData=l),ref_key:"base_form",ref:E},null,8,["settings","modelValue"])]),_:1},8,["title","modelValue"]),r(Ie,{modelValue:$.value,"onUpdate:modelValue":e[5]||(e[5]=l=>$.value=l),size:"auto","img-list":M.value,title:L.value,"init-number":R.value},null,8,["modelValue","img-list","title","init-number"])])}}},He=fe($e,[["__scopeId","data-v-82ef4315"]]);export{He as default};
